<!doctype html><html lang=zh class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.85.0"><meta name=ROBOTS content="INDEX, FOLLOW"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>从 CloudWeGo 谈云原生时代的微服务与开源 | CloudWeGo</title><meta name=description content="A leading practice for building enterprise cloud native middleware!"><meta property="og:title" content="从 CloudWeGo 谈云原生时代的微服务与开源"><meta property="og:description" content="从 CloudWeGo 谈云原生时代的微服务与开源  本文整理自罗广明在 DIVE 全球基础软件创新大会 2022 的演讲分享，主题为《从 CloudWeGo 谈云原生时代的微服务与开源》。
 01 项目创造的思考与哲学 我们团队经常会被人问到，你们为什么创造一个新的项目？我认为这是一个哲学问题。
纵观整个开源社区，每个时间段都会有各种各样的项目被重复地创造出来，这其中的大部分项目很快便销声匿迹了，只有一部分项目能够存活下来。当旁观者看到这样一番景象时，渐渐地，越来越多的人停留于项目搜寻，而放弃了成为项目创作者的机会。久而久之，我们开始忧虑下一代是否还会有新的项目可以使用？难道未来在同一领域，一个项目就能统一整个市场？
其实，在程序员的世界里，参考旧的项目来创造新的项目一点都不可耻。创造不仅意味着思考、权衡与设计，更需要我们贡献项目的特殊与差异。这其中涌现了很多后起之秀，正是他们促成了开源社区的多样性。“每一行代码都是一次精心的设计”是我们对优秀创造者的最佳赞誉。而一项优秀的代码设计往往包含两个最基本的特性：正确性和可维护性。同时，这两种特性恰恰又对应了两种不同的人格。
第一种人格，设计者与实现者，其驾驭是相对简单的，只要功能实现，通过测试，运行正确就算完成了。然而，第二种人格，阅读者和维护者，却要求更高的代码质量，更明晰的代码结构和更好的扩展性。只有同时具备这两种人格，开发者才能游刃有余地创造出一个优秀的项目。
优秀的项目被创造出来意味着什么呢？千千万万的用户可以评估并且使用它。这也从侧面表明了开源本身可以避免更多项目被重复地创造出来。
02 CloudWeGo 简介 CloudWeGo 是字节跳动基础架构团队开源出来的项目，它是一套可快速构建企业级云原生架构的中间件集合，它专注于微服务通信与治理，具备高性能、可扩展、高可靠的特点，且关注易用性。
CloudWeGo 在第一阶段开源了四个项目：
 Kitex：高性能、强可扩展的 Golang RPC 框架 Netpoll：高性能、I/O 非阻塞、专注于 RPC 场景的网络框架 Thriftgo：Golang 实现的 thrift 编译器，支持插件机制和语义检查 Netpoll-http2：基于 Netpoll 的 HTTP/2 实现  除了这几个主要项目外，CloudWeGo 紧随其后陆续开源了 Kitex-benchmark、Netpoll-benchmark、Thrift-gen-validator、Kitex-examples 、Netpoll-examples等项目。
鉴于文章篇幅有限，下文将重点介绍 CloudWeGo 核心项目 Kitex。
从演进历史来看，2014 年，字节跳动技术团队引入 Golang 解决长连接推送业务面临的高并发问题，两年后，内部技术团队基于 Golang 推出了一个名为 Kite 的框架，同时对开源项目 Gin 做了一层很薄的封装，推出了 Ginex。这两个框架极大推动了 Golang 在公司内部的应用。此后，围绕性能和可扩展性设计，字节跳动重构 Kite，并在次年 10 月完成并发布Kitex，投入到内部应用中。据悉，截至 2021 年 9 月，线上有 3w+ 微服务使用 Kitex，大部分服务迁移新框架后可以收获 CPU 和延迟上的收益。"><meta property="og:type" content="article"><meta property="og:url" content="/zh/blog/2022/05/26/%E4%BB%8E-cloudwego-%E8%B0%88%E4%BA%91%E5%8E%9F%E7%94%9F%E6%97%B6%E4%BB%A3%E7%9A%84%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%B8%8E%E5%BC%80%E6%BA%90/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2022-05-26T00:00:00+00:00"><meta property="article:modified_time" content="2022-06-16T17:48:03+08:00"><meta property="og:site_name" content="CloudWeGo"><meta itemprop=name content="从 CloudWeGo 谈云原生时代的微服务与开源"><meta itemprop=description content="从 CloudWeGo 谈云原生时代的微服务与开源  本文整理自罗广明在 DIVE 全球基础软件创新大会 2022 的演讲分享，主题为《从 CloudWeGo 谈云原生时代的微服务与开源》。
 01 项目创造的思考与哲学 我们团队经常会被人问到，你们为什么创造一个新的项目？我认为这是一个哲学问题。
纵观整个开源社区，每个时间段都会有各种各样的项目被重复地创造出来，这其中的大部分项目很快便销声匿迹了，只有一部分项目能够存活下来。当旁观者看到这样一番景象时，渐渐地，越来越多的人停留于项目搜寻，而放弃了成为项目创作者的机会。久而久之，我们开始忧虑下一代是否还会有新的项目可以使用？难道未来在同一领域，一个项目就能统一整个市场？
其实，在程序员的世界里，参考旧的项目来创造新的项目一点都不可耻。创造不仅意味着思考、权衡与设计，更需要我们贡献项目的特殊与差异。这其中涌现了很多后起之秀，正是他们促成了开源社区的多样性。“每一行代码都是一次精心的设计”是我们对优秀创造者的最佳赞誉。而一项优秀的代码设计往往包含两个最基本的特性：正确性和可维护性。同时，这两种特性恰恰又对应了两种不同的人格。
第一种人格，设计者与实现者，其驾驭是相对简单的，只要功能实现，通过测试，运行正确就算完成了。然而，第二种人格，阅读者和维护者，却要求更高的代码质量，更明晰的代码结构和更好的扩展性。只有同时具备这两种人格，开发者才能游刃有余地创造出一个优秀的项目。
优秀的项目被创造出来意味着什么呢？千千万万的用户可以评估并且使用它。这也从侧面表明了开源本身可以避免更多项目被重复地创造出来。
02 CloudWeGo 简介 CloudWeGo 是字节跳动基础架构团队开源出来的项目，它是一套可快速构建企业级云原生架构的中间件集合，它专注于微服务通信与治理，具备高性能、可扩展、高可靠的特点，且关注易用性。
CloudWeGo 在第一阶段开源了四个项目：
 Kitex：高性能、强可扩展的 Golang RPC 框架 Netpoll：高性能、I/O 非阻塞、专注于 RPC 场景的网络框架 Thriftgo：Golang 实现的 thrift 编译器，支持插件机制和语义检查 Netpoll-http2：基于 Netpoll 的 HTTP/2 实现  除了这几个主要项目外，CloudWeGo 紧随其后陆续开源了 Kitex-benchmark、Netpoll-benchmark、Thrift-gen-validator、Kitex-examples 、Netpoll-examples等项目。
鉴于文章篇幅有限，下文将重点介绍 CloudWeGo 核心项目 Kitex。
从演进历史来看，2014 年，字节跳动技术团队引入 Golang 解决长连接推送业务面临的高并发问题，两年后，内部技术团队基于 Golang 推出了一个名为 Kite 的框架，同时对开源项目 Gin 做了一层很薄的封装，推出了 Ginex。这两个框架极大推动了 Golang 在公司内部的应用。此后，围绕性能和可扩展性设计，字节跳动重构 Kite，并在次年 10 月完成并发布Kitex，投入到内部应用中。据悉，截至 2021 年 9 月，线上有 3w+ 微服务使用 Kitex，大部分服务迁移新框架后可以收获 CPU 和延迟上的收益。"><meta itemprop=datePublished content="2022-05-26T00:00:00+00:00"><meta itemprop=dateModified content="2022-06-16T17:48:03+08:00"><meta itemprop=wordCount content="530"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="从 CloudWeGo 谈云原生时代的微服务与开源"><meta name=twitter:description content="从 CloudWeGo 谈云原生时代的微服务与开源  本文整理自罗广明在 DIVE 全球基础软件创新大会 2022 的演讲分享，主题为《从 CloudWeGo 谈云原生时代的微服务与开源》。
 01 项目创造的思考与哲学 我们团队经常会被人问到，你们为什么创造一个新的项目？我认为这是一个哲学问题。
纵观整个开源社区，每个时间段都会有各种各样的项目被重复地创造出来，这其中的大部分项目很快便销声匿迹了，只有一部分项目能够存活下来。当旁观者看到这样一番景象时，渐渐地，越来越多的人停留于项目搜寻，而放弃了成为项目创作者的机会。久而久之，我们开始忧虑下一代是否还会有新的项目可以使用？难道未来在同一领域，一个项目就能统一整个市场？
其实，在程序员的世界里，参考旧的项目来创造新的项目一点都不可耻。创造不仅意味着思考、权衡与设计，更需要我们贡献项目的特殊与差异。这其中涌现了很多后起之秀，正是他们促成了开源社区的多样性。“每一行代码都是一次精心的设计”是我们对优秀创造者的最佳赞誉。而一项优秀的代码设计往往包含两个最基本的特性：正确性和可维护性。同时，这两种特性恰恰又对应了两种不同的人格。
第一种人格，设计者与实现者，其驾驭是相对简单的，只要功能实现，通过测试，运行正确就算完成了。然而，第二种人格，阅读者和维护者，却要求更高的代码质量，更明晰的代码结构和更好的扩展性。只有同时具备这两种人格，开发者才能游刃有余地创造出一个优秀的项目。
优秀的项目被创造出来意味着什么呢？千千万万的用户可以评估并且使用它。这也从侧面表明了开源本身可以避免更多项目被重复地创造出来。
02 CloudWeGo 简介 CloudWeGo 是字节跳动基础架构团队开源出来的项目，它是一套可快速构建企业级云原生架构的中间件集合，它专注于微服务通信与治理，具备高性能、可扩展、高可靠的特点，且关注易用性。
CloudWeGo 在第一阶段开源了四个项目：
 Kitex：高性能、强可扩展的 Golang RPC 框架 Netpoll：高性能、I/O 非阻塞、专注于 RPC 场景的网络框架 Thriftgo：Golang 实现的 thrift 编译器，支持插件机制和语义检查 Netpoll-http2：基于 Netpoll 的 HTTP/2 实现  除了这几个主要项目外，CloudWeGo 紧随其后陆续开源了 Kitex-benchmark、Netpoll-benchmark、Thrift-gen-validator、Kitex-examples 、Netpoll-examples等项目。
鉴于文章篇幅有限，下文将重点介绍 CloudWeGo 核心项目 Kitex。
从演进历史来看，2014 年，字节跳动技术团队引入 Golang 解决长连接推送业务面临的高并发问题，两年后，内部技术团队基于 Golang 推出了一个名为 Kite 的框架，同时对开源项目 Gin 做了一层很薄的封装，推出了 Ginex。这两个框架极大推动了 Golang 在公司内部的应用。此后，围绕性能和可扩展性设计，字节跳动重构 Kite，并在次年 10 月完成并发布Kitex，投入到内部应用中。据悉，截至 2021 年 9 月，线上有 3w+ 微服务使用 Kitex，大部分服务迁移新框架后可以收获 CPU 和延迟上的收益。"><script async src="https://www.googletagmanager.com/gtag/js?id=G-QYWRQRLPRM"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-QYWRQRLPRM')</script><link rel=preload href=/scss/main.min.f95524309453418871a413b9a587face83fc966617fd43915c481936076f7a1d.css as=style><link href=/scss/main.min.f95524309453418871a413b9a587face83fc966617fd43915c481936076f7a1d.css rel=stylesheet integrity><script src=https://cdn.staticfile.org/jquery/3.5.1/jquery.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','G-QYWRQRLPRM','auto'),ga('send','pageview'))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class="td-page td-blog"><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/zh/><span class=navbar-logo><img src=/img/logo.png></span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="dropdown sub-menu"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false><span>文档</span></a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/zh/docs/kitex/>Kitex</a>
<a class=dropdown-item href=/zh/docs/hertz/>Hertz</a>
<a class=dropdown-item href=/zh/docs/netpoll/>Netpoll</a></div></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/zh/about/><span>关于</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/zh/blog/><span class=active>博客</span></a></li><li class="dropdown sub-menu"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false><span>社区</span></a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/zh/community/>概述</a>
<a class=dropdown-item href=/zh/community/meeting_notes/>会议记录</a>
<a class=dropdown-item href=/zh/community/weekly_report/>周报</a></div></li><li class="nav-item dropdown mr-4 d-none d-lg-block"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>中文</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/>English</a></div></li></ul></div><div class="navbar-nav d-none d-lg-block"></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><div id=content-mobile><form class="td-sidebar__search d-flex align-items-center"><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation"></button></form></div><div id=content-desktop></div><nav class="collapse td-sidebar-nav" id=td-section-nav><div class="nav-item dropdown d-block d-lg-none"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>中文</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/>English</a></div></div><ul class="td-sidebar-nav__section pr-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-zhblog-li><a href=/zh/blog/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-zhblog><span>博客</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-zhblognews-li><a href=/zh/blog/news/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-zhblognews><span>新闻</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-zhblog20220526e4bb8e-cloudwego-e8b088e4ba91e58e9fe7949fe697b6e4bba3e79a84e5beaee69c8de58aa1e4b88ee5bc80e6ba90-li><a href=/zh/blog/2022/05/26/%E4%BB%8E-cloudwego-%E8%B0%88%E4%BA%91%E5%8E%9F%E7%94%9F%E6%97%B6%E4%BB%A3%E7%9A%84%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%B8%8E%E5%BC%80%E6%BA%90/ class="align-left pl-0 active td-sidebar-link td-sidebar-link__page" id=m-zhblog20220526e4bb8e-cloudwego-e8b088e4ba91e58e9fe7949fe697b6e4bba3e79a84e5beaee69c8de58aa1e4b88ee5bc80e6ba90><span class=td-sidebar-nav-active-item>从 CloudWeGo 谈云原生时代的微服务与开源</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhblog20220519e5ad97e88a82e5beaee69c8de58aa1e6a186e69eb6e79a84e68c91e68898e5928ce6bc94e8bf9b-li><a href=/zh/blog/2022/05/19/%E5%AD%97%E8%8A%82%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%A1%86%E6%9E%B6%E7%9A%84%E6%8C%91%E6%88%98%E5%92%8C%E6%BC%94%E8%BF%9B/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhblog20220519e5ad97e88a82e5beaee69c8de58aa1e6a186e69eb6e79a84e68c91e68898e5928ce6bc94e8bf9b><span>字节微服务框架的挑战和演进</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhblog20220401cloudwego-e58aa9-nextarch-e59fbae98791e4bc9ae68ea8e58aa8e6a087e58786e58c96e5bbbae8aebe-li><a href=/zh/blog/2022/04/01/cloudwego-%E5%8A%A9-nextarch-%E5%9F%BA%E9%87%91%E4%BC%9A%E6%8E%A8%E5%8A%A8%E6%A0%87%E5%87%86%E5%8C%96%E5%BB%BA%E8%AE%BE/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhblog20220401cloudwego-e58aa9-nextarch-e59fbae98791e4bc9ae68ea8e58aa8e6a087e58786e58c96e5bbbae8aebe><span>CloudWeGo 助 NextArch 基金会推动标准化建设</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhblog20220328e4b880e69687e4ba86e8a7a3e5ad97e88a82e8b7b3e58aa8e5beaee69c8de58aa1e4b8ade997b4e4bbb6-cloudwego-li><a href=/zh/blog/2022/03/28/%E4%B8%80%E6%96%87%E4%BA%86%E8%A7%A3%E5%AD%97%E8%8A%82%E8%B7%B3%E5%8A%A8%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%B8%AD%E9%97%B4%E4%BB%B6-cloudwego/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhblog20220328e4b880e69687e4ba86e8a7a3e5ad97e88a82e8b7b3e58aa8e5beaee69c8de58aa1e4b8ade997b4e4bbb6-cloudwego><span>一文了解字节跳动微服务中间件 CloudWeGo</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhblog20211124rpc-e6a186e69eb6-kitex-e5ae9ee8b7b5e585a5e997a8e680a7e883bde6b58be8af95e68c87e58d97-li><a href=/zh/blog/2021/11/24/rpc-%E6%A1%86%E6%9E%B6-kitex-%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E6%8C%87%E5%8D%97/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhblog20211124rpc-e6a186e69eb6-kitex-e5ae9ee8b7b5e585a5e997a8e680a7e883bde6b58be8af95e68c87e58d97><span>RPC 框架 Kitex 实践入门：性能测试指南</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhblog20211009e5ad97e88a82e8b7b3e58aa8e59ca8-go-e7bd91e7bb9ce5ba93e4b88ae79a84e5ae9ee8b7b5-li><a href=/zh/blog/2021/10/09/%E5%AD%97%E8%8A%82%E8%B7%B3%E5%8A%A8%E5%9C%A8-go-%E7%BD%91%E7%BB%9C%E5%BA%93%E4%B8%8A%E7%9A%84%E5%AE%9E%E8%B7%B5/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhblog20211009e5ad97e88a82e8b7b3e58aa8e59ca8-go-e7bd91e7bb9ce5ba93e4b88ae79a84e5ae9ee8b7b5><span>字节跳动在 Go 网络库上的实践</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhblog20210923e5ad97e88a82e8b7b3e58aa8-go-rpc-e6a186e69eb6-kitex-e680a7e883bde4bc98e58c96e5ae9ee8b7b5-li><a href=/zh/blog/2021/09/23/%E5%AD%97%E8%8A%82%E8%B7%B3%E5%8A%A8-go-rpc-%E6%A1%86%E6%9E%B6-kitex-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%AE%9E%E8%B7%B5/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhblog20210923e5ad97e88a82e8b7b3e58aa8-go-rpc-e6a186e69eb6-kitex-e680a7e883bde4bc98e58c96e5ae9ee8b7b5><span>字节跳动 Go RPC 框架 Kitex 性能优化实践</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhblog20210907e5ad97e88a82e8b7b3e58aa8e5bc80e6ba90e58685e983a8e5beaee69c8de58aa1e4b8ade997b4e4bbb6-cloudwego-li><a href=/zh/blog/2021/09/07/%E5%AD%97%E8%8A%82%E8%B7%B3%E5%8A%A8%E5%BC%80%E6%BA%90%E5%86%85%E9%83%A8%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%B8%AD%E9%97%B4%E4%BB%B6-cloudwego/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhblog20210907e5ad97e88a82e8b7b3e58aa8e5bc80e6ba90e58685e983a8e5beaee69c8de58aa1e4b8ade997b4e4bbb6-cloudwego><span>字节跳动开源内部微服务中间件 CloudWeGo</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-zhblogreleases-li><a href=/zh/blog/releases/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-zhblogreleases><span>发布</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-zhblogreleaseskitex-li><a href=/zh/blog/releases/kitex/ title="Kitex Release" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-zhblogreleaseskitex><span>Kitex</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhblog20220602kitex-v032-e78988e69cace58f91e5b883-li><a href=/zh/blog/2022/06/02/kitex-v0.3.2-%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83/ title="Kitex v0.3.2 版本发布" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhblog20220602kitex-v032-e78988e69cace58f91e5b883><span>Release v0.3.2</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhblog20220429kitex-v030-e78988e69cace58f91e5b883-li><a href=/zh/blog/2022/04/29/kitex-v0.3.0-%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83/ title="Kitex v0.3.0 版本发布" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhblog20220429kitex-v030-e78988e69cace58f91e5b883><span>Release v0.3.0</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhblog20220324kitex-v021-e78988e69cace58f91e5b883-li><a href=/zh/blog/2022/03/24/kitex-v0.2.1-%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83/ title="Kitex v0.2.1 版本发布" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhblog20220324kitex-v021-e78988e69cace58f91e5b883><span>Release v0.2.1</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhblog20220224kitex-v020-e78988e69cace58f91e5b883-li><a href=/zh/blog/2022/02/24/kitex-v0.2.0-%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83/ title="Kitex v0.2.0 版本发布" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhblog20220224kitex-v020-e78988e69cace58f91e5b883><span>Release v0.2.0</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhblog20220118kitex-v014-e78988e69cace58f91e5b883-li><a href=/zh/blog/2022/01/18/kitex-v0.1.4-%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83/ title="Kitex v0.1.4 版本发布" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhblog20220118kitex-v014-e78988e69cace58f91e5b883><span>Release v0.1.4</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhblog20211230kitex-v013-e78988e69cace58f91e5b883-li><a href=/zh/blog/2021/12/30/kitex-v0.1.3-%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83/ title="Kitex v0.1.3 版本发布" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhblog20211230kitex-v013-e78988e69cace58f91e5b883><span>Release v0.1.3</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhblog20211222kitex-v012-e78988e69cace58f91e5b883-li><a href=/zh/blog/2021/12/22/kitex-v0.1.2-%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83/ title="Kitex v0.1.2 版本发布" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhblog20211222kitex-v012-e78988e69cace58f91e5b883><span>Release v0.1.2</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhblog20211213kitex-v010-e78988e69cace58f91e5b883-li><a href=/zh/blog/2021/12/13/kitex-v0.1.0-%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83/ title="Kitex v0.1.0 版本发布" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhblog20211213kitex-v010-e78988e69cace58f91e5b883><span>Release v0.1.0</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhblog20211105kitex-v008-e78988e69cace58f91e5b883-li><a href=/zh/blog/2021/11/05/kitex-v0.0.8-%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83/ title="Kitex v0.0.8 版本发布" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhblog20211105kitex-v008-e78988e69cace58f91e5b883><span>Release v0.0.8</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhblog20210926kitex-v005-e78988e69cace58f91e5b883-li><a href=/zh/blog/2021/09/26/kitex-v0.0.5-%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83/ title="Kitex v0.0.5 版本发布" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhblog20210926kitex-v005-e78988e69cace58f91e5b883><span>Release v0.0.5</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhblog20210826kitex-v004-e78988e69cace58f91e5b883-li><a href=/zh/blog/2021/08/26/kitex-v0.0.4-%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83/ title="Kitex v0.0.4 版本发布" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhblog20210826kitex-v004-e78988e69cace58f91e5b883><span>Release v0.0.4</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhblog20210801kitex-v003-e78988e69cace58f91e5b883-li><a href=/zh/blog/2021/08/01/kitex-v0.0.3-%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83/ title="Kitex v0.0.3 版本发布" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhblog20210801kitex-v003-e78988e69cace58f91e5b883><span>Release v0.0.3</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhblog20210730kitex-v002-e78988e69cace58f91e5b883-li><a href=/zh/blog/2021/07/30/kitex-v0.0.2-%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83/ title="Kitex v0.0.2 版本发布" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhblog20210730kitex-v002-e78988e69cace58f91e5b883><span>Release v0.0.2</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhblog20210712kitex-v001-e78988e69cace58f91e5b883-li><a href=/zh/blog/2021/07/12/kitex-v0.0.1-%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83/ title="Kitex v0.0.1 版本发布" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhblog20210712kitex-v001-e78988e69cace58f91e5b883><span>Release v0.0.1</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-zhblogreleasesnetpoll-li><a href=/zh/blog/releases/netpoll/ title="Netpoll Release" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-zhblogreleasesnetpoll><span>Netpoll</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhblog20220428netpoll-v022-e78988e69cace58f91e5b883-li><a href=/zh/blog/2022/04/28/netpoll-v0.2.2-%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83/ title="Netpoll v0.2.2 版本发布" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhblog20220428netpoll-v022-e78988e69cace58f91e5b883><span>Release v0.2.2</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhblog20220222netpoll-v020-e78988e69cace58f91e5b883-li><a href=/zh/blog/2022/02/22/netpoll-v0.2.0-%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83/ title="Netpoll v0.2.0 版本发布" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhblog20220222netpoll-v020-e78988e69cace58f91e5b883><span>Release v0.2.0</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhblog20211213netpoll-v012-e78988e69cace58f91e5b883-li><a href=/zh/blog/2021/12/13/netpoll-v0.1.2-%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83/ title="Netpoll v0.1.2 版本发布" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhblog20211213netpoll-v012-e78988e69cace58f91e5b883><span>Release v0.1.2</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhblog20211209netpoll-v011-e78988e69cace58f91e5b883-li><a href=/zh/blog/2021/12/09/netpoll-v0.1.1-%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83/ title="Netpoll v0.1.1 版本发布" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhblog20211209netpoll-v011-e78988e69cace58f91e5b883><span>Release v0.1.1</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhblog20211201netpoll-v010-e78988e69cace58f91e5b883-li><a href=/zh/blog/2021/12/01/netpoll-v0.1.0-%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83/ title="Netpoll v0.1.0 版本发布" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhblog20211201netpoll-v010-e78988e69cace58f91e5b883><span>Release v0.1.0</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhblog20210916netpoll-v004-e78988e69cace58f91e5b883-li><a href=/zh/blog/2021/09/16/netpoll-v0.0.4-%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83/ title="Netpoll v0.0.4 版本发布" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhblog20210916netpoll-v004-e78988e69cace58f91e5b883><span>Release v0.0.4</span></a></li></ul></li></ul></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/cloudwego/cloudwego.github.io/edit/main/content/zh/blog/news/Microservices_OpenSource_CloudWeGo/index.md target=_blank><i class="fa fa-edit fa-fw"></i> 编辑此页</a>
<a href="https://github.com/cloudwego/cloudwego.github.io/new/main/content/zh/blog/news/Microservices_OpenSource_CloudWeGo/index.md?filename=change-me.md&value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" target=_blank><i class="fa fa-edit fa-fw"></i> 添加子页面</a>
<a href="https://github.com/cloudwego/cloudwego.github.io/issues/new?title=%e4%bb%8e%20CloudWeGo%20%e8%b0%88%e4%ba%91%e5%8e%9f%e7%94%9f%e6%97%b6%e4%bb%a3%e7%9a%84%e5%be%ae%e6%9c%8d%e5%8a%a1%e4%b8%8e%e5%bc%80%e6%ba%90" target=_blank><i class="fab fa-github fa-fw"></i> 提交文档问题</a>
<a href=https://github.com/cloudwego/kitex/issues/new target=_blank><i class="fas fa-tasks fa-fw"></i> 提交项目问题</a></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#01-项目创造的思考与哲学><strong>01 项目创造的思考与哲学</strong></a></li><li><a href=#02-cloudwego-简介><strong>02 CloudWeGo 简介</strong></a></li><li><a href=#03-cloudwego-的微服务治理><strong>03 CloudWeGo 的微服务治理</strong></a><ul><li><a href=#服务注册与发现><strong>服务注册与发现</strong></a></li><li><a href=#熔断><strong>熔断</strong></a></li><li><a href=#限流><strong>限流</strong></a></li><li><a href=#请求重试><strong>请求重试</strong></a></li><li><a href=#负载均衡><strong>负载均衡</strong></a></li><li><a href=#可观测性><strong>可观测性</strong></a></li><li><a href=#微服务框架与服务网格><strong>微服务框架与服务网格</strong></a></li></ul></li><li><a href=#04-cloudwego-的开源之路><strong>04 CloudWeGo 的开源之路</strong></a><ul><li><a href=#开源的原因><strong>开源的原因</strong></a></li><li><a href=#开源的历程><strong>开源的历程</strong></a></li><li><a href=#后续的规划><strong>后续的规划</strong></a></li></ul></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 pl-md-5 pr-md-4" role=main><div class=td-content><h1>从 CloudWeGo 谈云原生时代的微服务与开源</h1><div class="td-byline mb-4">By <b><a href=https://github.com/GuangmingLuo target=_blank>GuangmingLuo</a></b> |
<time datetime=2022-05-26 class=text-muted>Thursday, May 26, 2022</time></div><header class=article-meta></header><h1 id=从-cloudwego-谈云原生时代的微服务与开源>从 CloudWeGo 谈云原生时代的微服务与开源</h1><blockquote><p>本文整理自罗广明在 DIVE 全球基础软件创新大会 2022 的演讲分享，主题为《从 CloudWeGo 谈云原生时代的微服务与开源》。</p></blockquote><h2 id=01-项目创造的思考与哲学><strong>01 项目创造的思考与哲学</strong></h2><p>我们团队经常会被人问到，你们为什么创造一个新的项目？我认为这是一个哲学问题。</p><p>纵观整个开源社区，每个时间段都会有各种各样的项目被重复地创造出来，这其中的大部分项目很快便销声匿迹了，只有一部分项目能够存活下来。当旁观者看到这样一番景象时，渐渐地，越来越多的人停留于项目搜寻，而放弃了成为项目创作者的机会。久而久之，我们开始忧虑下一代是否还会有新的项目可以使用？难道未来在同一领域，一个项目就能统一整个市场？</p><p>其实，在程序员的世界里，参考旧的项目来创造新的项目一点都不可耻。创造不仅意味着思考、权衡与设计，更需要我们贡献项目的特殊与差异。这其中涌现了很多后起之秀，正是他们促成了开源社区的多样性。“每一行代码都是一次精心的设计”是我们对优秀创造者的最佳赞誉。而一项优秀的代码设计往往包含两个最基本的特性：正确性和可维护性。同时，这两种特性恰恰又对应了两种不同的人格。</p><p>第一种人格，设计者与实现者，其驾驭是相对简单的，只要功能实现，通过测试，运行正确就算完成了。然而，第二种人格，阅读者和维护者，却要求更高的代码质量，更明晰的代码结构和更好的扩展性。只有同时具备这两种人格，开发者才能游刃有余地创造出一个优秀的项目。</p><p>优秀的项目被创造出来意味着什么呢？千千万万的用户可以评估并且使用它。这也从侧面表明了开源本身可以避免更多项目被重复地创造出来。</p><h2 id=02-cloudwego-简介><strong>02 CloudWeGo 简介</strong></h2><p>CloudWeGo 是字节跳动基础架构团队开源出来的项目，它是一套可快速构建<strong>企业级</strong>云原生架构的中间件集合，它专注于微服务通信与治理，具备<strong>高性能</strong>、<strong>可扩展</strong>、<strong>高可靠</strong>的特点，且关注<strong>易用性</strong>。</p><p>CloudWeGo 在第一阶段开源了四个项目：</p><ul><li><a href=https://github.com/cloudwego/kitex><strong>Kitex</strong></a>：高性能、强可扩展的 Golang RPC 框架</li><li><a href=https://github.com/cloudwego/netpoll><strong>Netpoll</strong></a>：高性能、I/O 非阻塞、专注于 RPC 场景的网络框架</li><li><a href=https://github.com/cloudwego/thriftgo><strong>Thriftgo</strong></a>：Golang 实现的 thrift 编译器，支持插件机制和语义检查</li><li><a href=https://github.com/cloudwego/netpoll-http2><strong>Netpoll-http2</strong></a>：基于 Netpoll 的 HTTP/2 实现</li></ul><p>除了这几个主要项目外，CloudWeGo 紧随其后陆续开源了 <a href=https://github.com/cloudwego/kitex-benchmark><strong>Kitex-benchmark</strong></a>、<a href=https://github.com/cloudwego/netpoll-benchmark><strong>Netpoll-benchmark</strong></a>、<a href=https://github.com/cloudwego/thrift-gen-validator><strong>Thrift-gen-validator</strong></a>、<a href=https://github.com/cloudwego/kitex-examples><strong>Kitex-examples</strong></a> 、<a href=https://github.com/cloudwego/netpoll-examples><strong>Netpoll-examples</strong></a>等项目。</p><p>鉴于文章篇幅有限，下文将重点介绍 CloudWeGo 核心项目 Kitex。</p><p>从<strong>演进历史</strong>来看，2014 年，字节跳动技术团队引入 Golang 解决长连接推送业务面临的高并发问题，两年后，内部技术团队基于 Golang 推出了一个名为 Kite 的框架，同时对开源项目 Gin 做了一层很薄的封装，推出了 Ginex。这两个框架极大推动了 Golang 在公司内部的应用。此后，围绕性能和可扩展性设计，字节跳动重构 Kite，并在次年 10 月完成并发布Kitex，投入到内部应用中。据悉，截至 2021 年 9 月，线上有 3w+ 微服务使用 Kitex，大部分服务迁移新框架后可以收获 CPU 和延迟上的收益。</p><p><img src=/img/blog/Microservices_Open_CloudWeGo/Framework.PNG alt=image></p><p>从<strong>架构</strong>上看，Kitex 主要分为两部分。其中 Kitex Core 是它的的主干逻辑，定义了框架的层次结构、接口，还有接口的默认实现。最上面 Client 和 Server 是对用户暴露的，包含 Option 配置以及其初始化的逻辑；中间的 Modules 模块是框架治理层面的功能模块和交互元信息，而 Remote 模块是与对端交互的模块，包括编解码和网络通信。另一部分 Kitex Tool 则是对应生成代码相关的实现，生成代码工具就是编译这个包得到的，里面包括 IDL 解析、校验、代码生成、插件支持、自更新等。</p><p>从<strong>功能与特性</strong>这两个角度来看，主要可以分为以下七个方面：</p><p><img src=/img/blog/Microservices_Open_CloudWeGo/Functions_Features.PNG alt=image></p><ul><li><strong>高性能</strong>：网络传输模块 Kitex 默认集成了自研的网络库 Netpoll，性能相较使用 go net 有显著优势；除了网络库带来的性能收益，Kitex 对 Thrift 编解码也做了深度优化。关于性能数据可参考 <a href=https://github.com/cloudwego/kitex-benchmark>kitex-benchmark</a>。</li><li><strong>扩展性</strong>：Kitex 设计上做了模块划分，提供了较多的扩展接口以及默认的扩展实现，使用者也可以根据需要自行定制扩展，更多扩展能力参见 CloudWeGo <a href=https://www.cloudwego.io/zh/docs/kitex/tutorials/framework-exten/>官网文档</a>。Kitex 也并未耦合 Netpoll，开发者也可以选择其它网络库扩展使用。</li><li><strong>消息协议</strong>：RPC 消息协议默认支持 Thrift、Kitex Protobuf、gRPC。Thrift 支持 Buffered 和 Framed 二进制协议；Kitex Protobuf 是 Kitex 自定义的 Protobuf 消息协议，协议格式类似 Thrift；gRPC 是对 gRPC 消息协议的支持，可以与 gRPC 互通。除此之外，使用者也可以扩展自己的消息协议。</li><li><strong>传输协议</strong>：传输协议封装消息协议进行 RPC 互通，传输协议可以额外透传元信息，用于服务治理，Kitex 支持的传输协议有 TTHeader、HTTP2。TTHeader 可以和 Thrift、Kitex Protobuf 结合使用；HTTP2 目前主要是结合 gRPC 协议使用，后续也会支持 Thrift。</li><li><strong>多消息类型</strong>：支持 PingPong、Oneway、双向 Streaming。其中 Oneway 目前只对 Thrift 协议支持，双向 Streaming 只对 gRPC 支持，后续会考虑支持 Thrift 的双向 Streaming。</li><li><strong>服务治理</strong>：支持服务注册/发现、负载均衡、熔断、限流、重试、监控、链路跟踪、日志、诊断等服务治理模块，大部分均已提供默认扩展，使用者可选择集成。</li><li><strong>Kitex 内置代码生成工具，可支持生成 Thrift、Protobuf 以及脚手架代码</strong>。原生的 Thrift 代码由本次一起开源的 Thriftgo 生成，Kitex 对 Thrift 的优化由 Kitex Tool 作为插件支持。Protobuf 代码由 Kitex 作为官方 protoc 插件生成 ，目前暂未单独支持 Protobuf IDL 的解析和代码生成。</li></ul><p>简单总结一下，CloudWeGo 不仅仅是一个开源的项目，也是一个真实的、超大规模的<strong>企业级</strong>最佳实践。它源自企业，所以天生就适合在企业内部落地；它源自开源，最终也拥抱了开源，从 Go 基础库，到 Go 网络库和 Thrift 编译器，再到上层的服务框架，以及框架拥有的所有企业级治理能力，均对外开放开源。</p><p><img src=/img/blog/Microservices_Open_CloudWeGo/Enterprise.PNG alt=image></p><h2 id=03-cloudwego-的微服务治理><strong>03 CloudWeGo 的微服务治理</strong></h2><p>微服务架构是当前软件开发领域的技术热点。大系统终究会拆解成小系统，“合久必分，分而治之”，传统行业的系统架构大多都是庞大的单体架构，微服务是架构发展过程中一个非常自然的演变状态。</p><p>那么，什么是微服务治理呢？众说纷纭，业界没有达成一个共识。广义上，服务治理关注服务生命周期相关要素，包括服务的架构设计、应用发布、注册发现、流量管理，监控与可观测性、故障定位、安全性等；又或将其分为架构治理、研发治理、测试治理、运维治理、管理治理。狭义上，服务治理技术包括服务注册与发现、可观测性、流量管理、安全、控制。后续主要是从狭义上服务治理的角度出发，展开介绍 CloudWeGo-Kitex 相关的思考和探索。</p><h3 id=服务注册与发现><strong>服务注册与发现</strong></h3><p>Kitex 并不提供默认的服务注册发现，体现了框架的<strong>中立</strong>特征。Kitex 支持自定义注册模块和发现模块，使用者可自行扩展集成其他注册中心和服务发现实现，该扩展分别定义在 Pkg/Registry 和 Pkg/Discovery 下。</p><p>Kitex 服务注册扩展接口如下所示，更多详情可以查看官网框架扩展 -> <a href=https://www.cloudwego.io/zh/docs/kitex/tutorials/framework-exten/registry/>服务注册扩展</a>。</p><p><img src=/img/blog/Microservices_Open_CloudWeGo/Service_registry.png alt=image></p><p>Kitex 服务发现扩展接口如下所示，更多详情可以查看官网框架扩展 -> <a href=https://www.cloudwego.io/zh/docs/kitex/tutorials/framework-exten/service_discovery/>服务发现扩展</a>。</p><p><img src=/img/blog/Microservices_Open_CloudWeGo/Service_discovery.png alt=image></p><p>截止日前，Kitex 已经通过社区开发者的支持，完成了 ETCD、ZooKeeper、Eureka、Consul、Nacos、Polaris 多种服务发现模式，当然也支持 DNS 解析以及 Static IP 直连访问模式，建立起了强大且完备的社区生态，供用户按需灵活选用。</p><p><img src=/img/blog/Microservices_Open_CloudWeGo/Community_ecology.PNG alt=image></p><p>特别鸣谢 @li-jin-gou @liu-song @baiyutang @duduainankai @horizonzy @Hanson 等几位社区贡献者对上述服务发现扩展库的实现与支持。更多代码详情可以查看 <a href=https://github.com/kitex-contrib>https://github.com/kitex-contrib</a> 。</p><h3 id=熔断><strong>熔断</strong></h3><p>前面介绍了 Kitex 服务注册与发现机制，这一点对于业务接入框架非常重要，缺少这一环节微服务之间无法实现互通。那么熔断对于微服务有什么作用呢？</p><p>在微服务进行 RPC 调用时，下游服务难免会出错，当下游出现问题时，如果上游继续对其进行调用，既妨碍了下游的恢复，也浪费了上游的资源。为了解决这个问题，可以设置一些动态开关，当下游出错时，手动的关闭对下游的调用，然而更好的办法是使用熔断器，自动解决这个问题。</p><p>Kitex 提供了熔断器的实现，但是没有默认开启，需要用户主动开启后即可使用。</p><p>Kitex 大部分服务治理模块都是通过 Middleware 集成，熔断也是一样。Kitex 提供了一套 CBSuite，封装了服务粒度的熔断器和实例粒度的熔断器。</p><ul><li><strong>服务粒度熔断</strong>：按照服务粒度进行熔断统计，通过 WithMiddleware 添加。服务粒度的具体划分取决于 Circuit Breaker Key，即熔断统计的 Key，初始化 CBSuite 时需要传入 <strong>GenServiceCBKeyFunc</strong>。默认提供的是 <code>circuitbreaker.RPCInfo2Key</code>，该 Key 的格式是 <code>fromServiceName/toServiceName/method</code>，即按照方法级别的异常做熔断统计。</li><li><strong>实例粒度熔断</strong>：按照实例粒度进行熔断统计，主要用于解决单实例异常问题，如果触发了实例级别熔断，框架会自动重试。</li></ul><p><strong>熔断器的思路很简单根据 RPC 成功或失败的情况，限制对下游的访问</strong>。通常熔断器分为三个时期：CLOSED、OPEN、HALFOPEN。当RPC 正常时，为 CLOSED；当 RPC 错误增多时，熔断器会被触发，进入 OPEN；OPEN 后经过一定的冷却时间，熔断器变为 HALFOPEN；HALFOPEN 时会对下游进行一些有策略的访问，然后根据结果决定是变为 CLOSED，还是 OPEN。总的来说三个状态的转换大致如下图：</p><p><img src=/img/blog/Microservices_Open_CloudWeGo/Conversion.png alt=image></p><p>关于 Kitex 熔断器实现的更多细节和原理，可以查看官网基本特性 -> <a href=https://www.cloudwego.io/zh/docs/kitex/tutorials/basic-feature/circuitbreaker/>熔断器</a>章节。</p><h3 id=限流><strong>限流</strong></h3><p>如果说熔断是从客户端出发保护调用链，以防止系统雪崩，那么限流则是一种保护服务端的措施，防止上游某个 Client 流量突增导致 Server 过载。</p><p>Kitex 支持限制最大连接数和最大 QPS。在初始化 Server 的时候，增加一个 Option：</p><p><img src=/img/blog/Microservices_Open_CloudWeGo/Server.png alt=image></p><p>其中 <code>MaxConnections</code> 表示最大连接数，MaxQPS` 表示最大 QPS，此外，Kitex 还提供了动态修改限流阈值的能力。</p><p>Kitex 分别使用了 ConcurrencyLimiter 和 RateLimiter 对最大连接数和最大 QPS 进行限流，其中 ConcurrencyLimiter 采用了简单的计数器算法，RateLimiter 采用了“令牌桶算法”。</p><p>限流状态的监控也是重要的一环，Kitex 定义了 <code>LimitReporter</code> 接口，用于限流状态监控，例如当前连接数过多、QPS 过大等。如有需求，用户需要自行实现该接口，并通过 <code>WithLimitReporter</code> 注入。</p><p><img src=/img/blog/Microservices_Open_CloudWeGo/LimitReporter.png alt=image></p><h3 id=请求重试><strong>请求重试</strong></h3><p>Kitex 提供三类重试：超时重试、Backup Request，建连失败重试。其中建连失败是网络层面问题，由于请求未发出，框架会默认重试，下面重点介绍前两类重试的使用。需要注意的是，因为很多的业务请求不具有<strong>幂等性</strong>，这两类重试不会作为默认策略，用户需要按需开启。</p><ul><li><strong>超时重试</strong>：错误重试的一种，即客户端收到超时错误的时候，发起重试请求。</li><li><strong>Backup Request</strong>：客户端在一段时间内还没收到返回，发起重试请求，任一请求成功即算成功。Backup Request 的等待时间 <code>RetryDelay</code> 建议配置为 TP99，一般远小于配置的超时时间 <code>Timeout</code>。</li></ul><p><img src=/img/blog/Microservices_Open_CloudWeGo/Timeout.png alt=image></p><p>服务中的长尾请求增加了服务的整体延迟，而长尾请求占比很低，如上图所示，一个真实服务的延迟分布，能明显看出长尾现象，最大延迟 60ms，而 99% 服务可以在 13ms 返回。当请求延迟达到 13ms 的时候就已经进入长尾请求，这个时候我们可以再发出一条请求，这条请求大概率会在 13ms 内返回，任意一次请求返回我们就认为请求成功，即通过增加适当的负载，大大减少了响应时间的波动。关于超时重试和 Backup Request 的优缺点以及适用场景，可见下表：</p><p><img src=/img/blog/Microservices_Open_CloudWeGo/Backup_Request.PNG alt=image></p><h3 id=负载均衡><strong>负载均衡</strong></h3><p>Kitex 默认提供了两种负载均衡算法实现：</p><ul><li><strong>WeightedRandom</strong>：这个算法使用的是基于权重的随机策略，也是 Kitex 的默认策略。它会依据实例的权重进行加权随机，并保证每个实例分配到的负载和自己的权重成比例。</li><li><strong>ConsistentHash</strong>：一致性哈希主要适用于对上下文（如实例本地缓存）依赖程度高的场景，如希望同一个类型的请求打到同一台机器，则可使用该负载均衡方法。</li></ul><p>ConsistentHash 在使用时，需要注意如下事项：</p><ul><li>下游节点发生变动时，一致性哈希结果可能会改变，某些 Key 可能会发生变化；</li><li>如果下游节点非常多，第一次冷启动时 Build 时间可能会较长，如果 RPC 超时短的话可能会导致超时；</li><li>如果第一次请求失败，并且 Replica 不为 0，那么会请求到 Replica 上；而第二次及以后仍然会请求第一个实例。</li></ul><h3 id=可观测性><strong>可观测性</strong></h3><p>框架自身不提供监控打点实现，提供了 <code>Tracer</code> 接口，用户可以根据需求实现该接口，并通过 <code>WithTracer</code> Option 注入到框架中。</p><p><img src=/img/blog/Microservices_Open_CloudWeGo/Tracer.png alt=image></p><p>Kitex 的监控打点、Metrics 上报以及链路追踪，都可以通过上述接口进行扩展。</p><p>目前 <a href=https://github.com/kitex-contrib>kitex-contrib</a> 组织下提供了 <a href=https://github.com/kitex-contrib/monitor-prometheus>Prometheus</a> 的监控扩展，<a href=https://github.com/kitex-contrib/tracer-opentracing>OpenTracing</a> 的链路追踪扩展，以及 <a href=https://github.com/kitex-contrib/obs-opentelemetry>OpenTelemetry</a> 可观测性全家桶（Metrics + Tracing + Logging）扩展实现，用户可以按需接入相应的扩展。</p><h3 id=微服务框架与服务网格><strong>微服务框架与服务网格</strong></h3><p><strong>服务框架</strong>是传统微服务技术的核心所在。早期微服务技术中的服务注册、发现、调用、治理、观测都离不开服务框架。这也带来了一些问题，比如业务研发者需要感知并使用服务框架的服务治理能力，框架版本升级困难，框架越来越重难于维护等等。</p><p><strong>服务网格（Service Mesh）</strong> 是将无侵入服务治理定义的更为深入的微服务架构方案，被称为第二代微服务架构。通过将微服务治理能力以独立组件（Sidecar）整合并下沉到基础设施，服务网格可以实现应用业务逻辑与服务治理逻辑完全分离，这也使支持<strong>多语言</strong>、<strong>热升级</strong>等高阶特性变得顺理成章。</p><p><img src=/img/blog/Microservices_Open_CloudWeGo/Service_Mesh.png alt=image></p><p>进入云原生时代，随着服务网格技术的逐步发展，我们也要用发展的眼光进行架构规划和设计，微服务框架和服务网格未来必定会是并存的，统一组成服务治理体系。在字节跳动，服务治理体系就是由服务框架和服务治理组成。以 Golang 服务为例，CloudWeGo 提供业务强相关、强侵入的服务治理，字节 Service Mesh 提供业务弱相关、弱侵入的服务治理，相互搭配，相互协商，既解决了业务开发所需的脚手架和开发模式，又让服务治理的接入更加容易。</p><p>与此同时，在服务网格和服务框架同时使用的场景下，服务框架必须要支持灵活卸载治理能力，服务网格也需要保证功能的稳定性。在未来技术的演进方向上，服务框架也主要专注于编解码、通信效率、多协议支持等方面，而服务网格则可以深入更多无侵入的服务治理功能研发中。</p><p>此外，在大规模场景下，针对服务治理新功能的研发需求决策，我们往往还需要考虑以下因素：</p><ul><li><strong>性能:</strong> 大部分业务很在意，也是团队一直努力的重点；</li><li><strong>普遍性</strong>:需要评估是不是所有业务都需要的能力；</li><li><strong>简洁</strong>: 通俗说，我们不太希望引入太多的线上问题或者太复杂的使用说明文档；</li><li><strong>ROI</strong>：功能迭代、产品升级需要考虑整体投资回报率。</li></ul><h2 id=04-cloudwego-的开源之路><strong>04 CloudWeGo 的开源之路</strong></h2><p><img src=/img/blog/Microservices_Open_CloudWeGo/Library.png alt=image></p><p>字节内部版本的 Kitex 是依赖于开源版本的 Kitex，因此可以理解为 Kitex 内外同源，不存在两个 Kitex。</p><h3 id=开源的原因><strong>开源的原因</strong></h3><p>回到开篇的问题，为什么要创造一个新的项目，并且开源 CloudWeGo 呢？</p><p>首先，CloudWeGo 里面的项目都是在字节内部经过大规模落地实践验证的，开源后每个功能的迭代也都是第一时间在内部使用验证过的，是一个真正的企业级落地项目，开源用户和字节内部业务使用的是同一套服务框架；其次，CloudWeGo 提供的功能，尤其是协议支持和服务治理，都是能解决真实业务痛点的，每一行代码优化都能实实在在地提升用户服务的性能；最后，CloudWeGo 的研发也借鉴了一些知名开源项目的设计思路，同时也依赖一些开源项目的实现，我们把 CloudWeGo 开源出去也是为了回馈社区，给开源社区贡献一份力量。</p><p>CloudWeGo 在设计之初，就同时考虑了正确性和可维护性，除了代码逻辑的正确性，高质量的代码、明晰的代码结构和优良的扩展性一直都是 CloudWeGo 追求的方向和实践的信条。</p><p>CloudWeGo 服务于用户、需求驱动，为用户提供开箱即用的服务框架及相关中间件，希望可以服务于更多企业和独立开发者，避免用户重复创造。</p><h3 id=开源的历程><strong>开源的历程</strong></h3><p><img src=/img/blog/Microservices_Open_CloudWeGo/Course.PNG alt=image></p><p>CloudWeGo 自 2021 年 9 月 8 日正式对外官宣，主要子项目 Kitex 先后发布 v0.1.0 和 v0.2.0，支持了许多新的功能，对性能、代码、文档也相继做了许多优化。截止到 2022 年 4 月，距离首次官宣 7 个月，仅 CloudWeGo-Kitex 就收获了 <strong>4000</strong> 个 Star，累计近 <strong>50</strong> 个 Contributors，达到了一个新的里程碑，这很有趣，并且十分振奋人心，不是吗？</p><p>CloudWeGo 团队自开源之初就非常重视社区建设，“<strong>Community Over Code</strong>” 也是 CloudWeGo 社区所遵循的文化和目标。</p><p>从搭建用户群，建设官网和文档，积极维护项目 Issue，及时处理新的 PR，再到我们与贡献者的深入沟通和对他们的培养，每一个动作都体现我们的决心。为了推进社区建设规范化和标准化，CloudWeGo 团队先后创建了 Community 仓库用来定义社区成员晋升机制以及存档社区材料。</p><p>为了践行公开透明和开源开放的开源文化，搭建开放的对话与交流平台，CloudWeGo 组织了社区双周例会，在例会上同步社区近期计划并积极听取社区成员的建议，与社区贡献者讨论相关技术方案实现。</p><p>截止目前，通过社区 Maintainer 的培养、Contributor 的主动申请、社区管理委员会的投票审批，已经正式通过了 5 位 Committer 的加入申请，极大地壮大了 CloudWeGo 社区核心力量，他们为社区的发展作出了重大贡献。</p><h3 id=后续的规划><strong>后续的规划</strong></h3><p>CloudWeGo 在 2021 年底收录进入 CNCF Landscape，丰富了 CNCF 在 RPC 领域的生态，给全球用户在做技术选型时提供了一套新的选择。</p><p>尽管取得了一些小小的成绩，但是 CloudWeGo 仍旧还是一个年轻的项目，开源贵在持之以恒、长期建设，CloudWeGo 团队也会持续完善，继续向前。</p><p>从社区建设方面来看，CloudWeGo 团队将继续提供更多新人友好的 Good-first-issue，坚持组织社区例会，定期举办开源技术沙龙，提供更易于理解的技术文档，另外也将继续欢迎更多新的开发者参与到社区建设中来。</p><p>从开源规划来看，HTTP 框架 Hertz 开源在即，还有更多中间件小工具、扩展库也都在持续开源中。此外，CloudWeGo 主创团队还研发了一套 Rust RPC 框架，正在内部落地实践验证中，在不久的将来，也将对外开源。</p><p><img src=/img/blog/Microservices_Open_CloudWeGo/Plan.png alt=image></p><p>从功能研发计划来看，以 CloudWeGo-Kitex 为例，将继续以内外部用户需求为驱动力，持续开发新的功能并迭代完善已有的功能。其中，包括支持连接预热、自定义异常重试、对 Protobuf 支持的性能优化，支持 xDS 协议等。</p><p>从开源生态来看，目前 CloudWeGo-Kitex 已经完成了诸多开源项目的对接，未来也将会按需支持更多开源生态。此外，CloudWeGo 也在和国内外主流公有云厂商进行合作对接，提供开箱即用、稳定可靠的微服务托管与治理产品的基座；CloudWeGo 也积极与国内外软件基金会开展合作和交流，探索新的合作模式。</p><p>CloudWeGo 未来可期，我们期待更多用户使用我们的项目，也期待有更多开发者可以加入共建 CloudWeGo 社区，共同见证云原生时代一个初生但了不起的微服务中间件和开源项目。</p><ul class="list-unstyled d-flex justify-content-between align-items-center mb-0 pt-5"><li><a href=/zh/blog/2022/05/19/%E5%AD%97%E8%8A%82%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%A1%86%E6%9E%B6%E7%9A%84%E6%8C%91%E6%88%98%E5%92%8C%E6%BC%94%E8%BF%9B/ aria-label="上一页 - 字节微服务框架的挑战和演进" class="btn btn-primary"><span class=mr-1>←</span> 上一页</a></li><a class="btn btn-primary disabled">下一页 <span class=ml-1>→</span></a></li></ul></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2022 The CloudWeGo Authors</small><p class="mt-2 text-white"><a class=cloudwego-link href=/about/ target=_blank rel=noopener>About</a>
|
<a class=cloudwego-link href=https://github.com/cloudwego/cloudwego.github.io/blob/main/LICENSE target=_blank rel=noopener>License</a></p></div></div></div></footer></div><script src=https://cdn.staticfile.org/popper.js/1.16.1/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script><script src=https://cdn.staticfile.org/bootstrap/4.6.0/js/bootstrap.min.js integrity=sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF crossorigin=anonymous></script><script src=/js/main.min.5c74b870c6953931a705f390a49c7e4c0a842ec5c83b24354758dd674343ed0d.js integrity="sha256-XHS4cMaVOTGnBfOQpJx+TAqELsXIOyQ1R1jdZ0ND7Q0=" crossorigin=anonymous></script></body></html>