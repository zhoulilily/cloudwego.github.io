<!doctype html><html lang=zh class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.85.0"><meta name=ROBOTS content="INDEX, FOLLOW"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>字节微服务框架的挑战和演进 | CloudWeGo</title><meta name=description content="A leading practice for building enterprise cloud native middleware!"><meta property="og:title" content="字节微服务框架的挑战和演进"><meta property="og:description" content="字节微服务框架的挑战和演进 2014 年以来，字节跳动内部业务的快速发展，推动了长连接推送服务，它们面临着高并发的业务需求问题，对性能和开发效率都有很高要求。当时的业务，大部分都是由 Python 开发，难以应对新出现的问题。项目负责人在一众现存的技术栈中选择了 Golang 这一门新兴的编程语言，快速解决了性能和开发效率的问题。随后，字节跳动内部开始逐渐推广使用 Golang 进行服务开发。
2016 年， 第一代 Golang RPC 框架 Kite 正式发布。Kite 是一个基于 Apache Thrift 进行包装的 RPC 框架，它在 Facebook 开源的 Thrift 之上提供了结合字节跳动内部基础设施的治理功能，同时还提供了一套简单易用的生成工具。随着 Kite 的发展，业务开始大规模使用 Golang。然而，在业务发展的过程中，由于研发专注于实现业务需求，对于框架的可维护性考量不足，Kite 逐渐背上了一些技术包袱，越来越难以满足业务在高性能和新特性方面的需求。因此我们决定对 Kite 进行重新设计，于是出现了 Kitex。
2020 年，Kitex 在内部发布了 v1.0.0，并且直接接入了 1,000+ 服务。由于 Kitex 的优秀性能和易用性，Kitex 在内部得到了大规模发展。直到 2021 年年中，字节跳动内部已有 2w+ 服务使用了 Kitex。因此，我们决定全面优化 Kitex，将其实践成果进行开源，反馈给开源社区。
字节跳动 Golang RPC 框架的演进 Kite 的缺陷 Kite 作为字节跳动第一代 Golang RPC 框架，主要存在以下缺陷：
 Kite 为了快速支持业务发展需求，不可避免地耦合了部分中台业务的功能； Kite 对 Go modules 支持不友好（Go modules 在 2019 年才进入语言核心）； Kite 自身的代码拆分成多仓库，版本更新时推动业务升级困难； Kite 强耦合了早期版本的 Apache Thrift，协议和功能拓展困难； Kite 的生成代码逻辑与框架接口强耦合，成为了性能优化的天花板。  因此，业务的快速发展和需求场景的多样化，催生了新一代 Golang RPC 框架 Kitex。"><meta property="og:type" content="article"><meta property="og:url" content="/zh/blog/2022/05/19/%E5%AD%97%E8%8A%82%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%A1%86%E6%9E%B6%E7%9A%84%E6%8C%91%E6%88%98%E5%92%8C%E6%BC%94%E8%BF%9B/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2022-05-19T00:00:00+00:00"><meta property="article:modified_time" content="2022-06-16T18:11:04+08:00"><meta property="og:site_name" content="CloudWeGo"><meta itemprop=name content="字节微服务框架的挑战和演进"><meta itemprop=description content="字节微服务框架的挑战和演进 2014 年以来，字节跳动内部业务的快速发展，推动了长连接推送服务，它们面临着高并发的业务需求问题，对性能和开发效率都有很高要求。当时的业务，大部分都是由 Python 开发，难以应对新出现的问题。项目负责人在一众现存的技术栈中选择了 Golang 这一门新兴的编程语言，快速解决了性能和开发效率的问题。随后，字节跳动内部开始逐渐推广使用 Golang 进行服务开发。
2016 年， 第一代 Golang RPC 框架 Kite 正式发布。Kite 是一个基于 Apache Thrift 进行包装的 RPC 框架，它在 Facebook 开源的 Thrift 之上提供了结合字节跳动内部基础设施的治理功能，同时还提供了一套简单易用的生成工具。随着 Kite 的发展，业务开始大规模使用 Golang。然而，在业务发展的过程中，由于研发专注于实现业务需求，对于框架的可维护性考量不足，Kite 逐渐背上了一些技术包袱，越来越难以满足业务在高性能和新特性方面的需求。因此我们决定对 Kite 进行重新设计，于是出现了 Kitex。
2020 年，Kitex 在内部发布了 v1.0.0，并且直接接入了 1,000+ 服务。由于 Kitex 的优秀性能和易用性，Kitex 在内部得到了大规模发展。直到 2021 年年中，字节跳动内部已有 2w+ 服务使用了 Kitex。因此，我们决定全面优化 Kitex，将其实践成果进行开源，反馈给开源社区。
字节跳动 Golang RPC 框架的演进 Kite 的缺陷 Kite 作为字节跳动第一代 Golang RPC 框架，主要存在以下缺陷：
 Kite 为了快速支持业务发展需求，不可避免地耦合了部分中台业务的功能； Kite 对 Go modules 支持不友好（Go modules 在 2019 年才进入语言核心）； Kite 自身的代码拆分成多仓库，版本更新时推动业务升级困难； Kite 强耦合了早期版本的 Apache Thrift，协议和功能拓展困难； Kite 的生成代码逻辑与框架接口强耦合，成为了性能优化的天花板。  因此，业务的快速发展和需求场景的多样化，催生了新一代 Golang RPC 框架 Kitex。"><meta itemprop=datePublished content="2022-05-19T00:00:00+00:00"><meta itemprop=dateModified content="2022-06-16T18:11:04+08:00"><meta itemprop=wordCount content="470"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="字节微服务框架的挑战和演进"><meta name=twitter:description content="字节微服务框架的挑战和演进 2014 年以来，字节跳动内部业务的快速发展，推动了长连接推送服务，它们面临着高并发的业务需求问题，对性能和开发效率都有很高要求。当时的业务，大部分都是由 Python 开发，难以应对新出现的问题。项目负责人在一众现存的技术栈中选择了 Golang 这一门新兴的编程语言，快速解决了性能和开发效率的问题。随后，字节跳动内部开始逐渐推广使用 Golang 进行服务开发。
2016 年， 第一代 Golang RPC 框架 Kite 正式发布。Kite 是一个基于 Apache Thrift 进行包装的 RPC 框架，它在 Facebook 开源的 Thrift 之上提供了结合字节跳动内部基础设施的治理功能，同时还提供了一套简单易用的生成工具。随着 Kite 的发展，业务开始大规模使用 Golang。然而，在业务发展的过程中，由于研发专注于实现业务需求，对于框架的可维护性考量不足，Kite 逐渐背上了一些技术包袱，越来越难以满足业务在高性能和新特性方面的需求。因此我们决定对 Kite 进行重新设计，于是出现了 Kitex。
2020 年，Kitex 在内部发布了 v1.0.0，并且直接接入了 1,000+ 服务。由于 Kitex 的优秀性能和易用性，Kitex 在内部得到了大规模发展。直到 2021 年年中，字节跳动内部已有 2w+ 服务使用了 Kitex。因此，我们决定全面优化 Kitex，将其实践成果进行开源，反馈给开源社区。
字节跳动 Golang RPC 框架的演进 Kite 的缺陷 Kite 作为字节跳动第一代 Golang RPC 框架，主要存在以下缺陷：
 Kite 为了快速支持业务发展需求，不可避免地耦合了部分中台业务的功能； Kite 对 Go modules 支持不友好（Go modules 在 2019 年才进入语言核心）； Kite 自身的代码拆分成多仓库，版本更新时推动业务升级困难； Kite 强耦合了早期版本的 Apache Thrift，协议和功能拓展困难； Kite 的生成代码逻辑与框架接口强耦合，成为了性能优化的天花板。  因此，业务的快速发展和需求场景的多样化，催生了新一代 Golang RPC 框架 Kitex。"><script async src="https://www.googletagmanager.com/gtag/js?id=G-QYWRQRLPRM"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-QYWRQRLPRM')</script><link rel=preload href=/scss/main.min.f95524309453418871a413b9a587face83fc966617fd43915c481936076f7a1d.css as=style><link href=/scss/main.min.f95524309453418871a413b9a587face83fc966617fd43915c481936076f7a1d.css rel=stylesheet integrity><script src=https://cdn.staticfile.org/jquery/3.5.1/jquery.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','G-QYWRQRLPRM','auto'),ga('send','pageview'))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class="td-page td-blog"><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/zh/><span class=navbar-logo><img src=/img/logo.png></span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="dropdown sub-menu"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false><span>文档</span></a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/zh/docs/kitex/>Kitex</a>
<a class=dropdown-item href=/zh/docs/hertz/>Hertz</a>
<a class=dropdown-item href=/zh/docs/netpoll/>Netpoll</a></div></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/zh/about/><span>关于</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/zh/blog/><span class=active>博客</span></a></li><li class="dropdown sub-menu"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false><span>社区</span></a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/zh/community/>概述</a>
<a class=dropdown-item href=/zh/community/meeting_notes/>会议记录</a>
<a class=dropdown-item href=/zh/community/weekly_report/>周报</a></div></li><li class="nav-item dropdown mr-4 d-none d-lg-block"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>中文</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/>English</a></div></li></ul></div><div class="navbar-nav d-none d-lg-block"></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><div id=content-mobile><form class="td-sidebar__search d-flex align-items-center"><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation"></button></form></div><div id=content-desktop></div><nav class="collapse td-sidebar-nav" id=td-section-nav><div class="nav-item dropdown d-block d-lg-none"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>中文</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/>English</a></div></div><ul class="td-sidebar-nav__section pr-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-zhblog-li><a href=/zh/blog/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-zhblog><span>博客</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-zhblognews-li><a href=/zh/blog/news/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-zhblognews><span>新闻</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhblog20220526e4bb8e-cloudwego-e8b088e4ba91e58e9fe7949fe697b6e4bba3e79a84e5beaee69c8de58aa1e4b88ee5bc80e6ba90-li><a href=/zh/blog/2022/05/26/%E4%BB%8E-cloudwego-%E8%B0%88%E4%BA%91%E5%8E%9F%E7%94%9F%E6%97%B6%E4%BB%A3%E7%9A%84%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%B8%8E%E5%BC%80%E6%BA%90/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhblog20220526e4bb8e-cloudwego-e8b088e4ba91e58e9fe7949fe697b6e4bba3e79a84e5beaee69c8de58aa1e4b88ee5bc80e6ba90><span>从 CloudWeGo 谈云原生时代的微服务与开源</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-zhblog20220519e5ad97e88a82e5beaee69c8de58aa1e6a186e69eb6e79a84e68c91e68898e5928ce6bc94e8bf9b-li><a href=/zh/blog/2022/05/19/%E5%AD%97%E8%8A%82%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%A1%86%E6%9E%B6%E7%9A%84%E6%8C%91%E6%88%98%E5%92%8C%E6%BC%94%E8%BF%9B/ class="align-left pl-0 active td-sidebar-link td-sidebar-link__page" id=m-zhblog20220519e5ad97e88a82e5beaee69c8de58aa1e6a186e69eb6e79a84e68c91e68898e5928ce6bc94e8bf9b><span class=td-sidebar-nav-active-item>字节微服务框架的挑战和演进</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhblog20220401cloudwego-e58aa9-nextarch-e59fbae98791e4bc9ae68ea8e58aa8e6a087e58786e58c96e5bbbae8aebe-li><a href=/zh/blog/2022/04/01/cloudwego-%E5%8A%A9-nextarch-%E5%9F%BA%E9%87%91%E4%BC%9A%E6%8E%A8%E5%8A%A8%E6%A0%87%E5%87%86%E5%8C%96%E5%BB%BA%E8%AE%BE/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhblog20220401cloudwego-e58aa9-nextarch-e59fbae98791e4bc9ae68ea8e58aa8e6a087e58786e58c96e5bbbae8aebe><span>CloudWeGo 助 NextArch 基金会推动标准化建设</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhblog20220328e4b880e69687e4ba86e8a7a3e5ad97e88a82e8b7b3e58aa8e5beaee69c8de58aa1e4b8ade997b4e4bbb6-cloudwego-li><a href=/zh/blog/2022/03/28/%E4%B8%80%E6%96%87%E4%BA%86%E8%A7%A3%E5%AD%97%E8%8A%82%E8%B7%B3%E5%8A%A8%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%B8%AD%E9%97%B4%E4%BB%B6-cloudwego/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhblog20220328e4b880e69687e4ba86e8a7a3e5ad97e88a82e8b7b3e58aa8e5beaee69c8de58aa1e4b8ade997b4e4bbb6-cloudwego><span>一文了解字节跳动微服务中间件 CloudWeGo</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhblog20211124rpc-e6a186e69eb6-kitex-e5ae9ee8b7b5e585a5e997a8e680a7e883bde6b58be8af95e68c87e58d97-li><a href=/zh/blog/2021/11/24/rpc-%E6%A1%86%E6%9E%B6-kitex-%E5%AE%9E%E8%B7%B5%E5%85%A5%E9%97%A8%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E6%8C%87%E5%8D%97/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhblog20211124rpc-e6a186e69eb6-kitex-e5ae9ee8b7b5e585a5e997a8e680a7e883bde6b58be8af95e68c87e58d97><span>RPC 框架 Kitex 实践入门：性能测试指南</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhblog20211009e5ad97e88a82e8b7b3e58aa8e59ca8-go-e7bd91e7bb9ce5ba93e4b88ae79a84e5ae9ee8b7b5-li><a href=/zh/blog/2021/10/09/%E5%AD%97%E8%8A%82%E8%B7%B3%E5%8A%A8%E5%9C%A8-go-%E7%BD%91%E7%BB%9C%E5%BA%93%E4%B8%8A%E7%9A%84%E5%AE%9E%E8%B7%B5/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhblog20211009e5ad97e88a82e8b7b3e58aa8e59ca8-go-e7bd91e7bb9ce5ba93e4b88ae79a84e5ae9ee8b7b5><span>字节跳动在 Go 网络库上的实践</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhblog20210923e5ad97e88a82e8b7b3e58aa8-go-rpc-e6a186e69eb6-kitex-e680a7e883bde4bc98e58c96e5ae9ee8b7b5-li><a href=/zh/blog/2021/09/23/%E5%AD%97%E8%8A%82%E8%B7%B3%E5%8A%A8-go-rpc-%E6%A1%86%E6%9E%B6-kitex-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%AE%9E%E8%B7%B5/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhblog20210923e5ad97e88a82e8b7b3e58aa8-go-rpc-e6a186e69eb6-kitex-e680a7e883bde4bc98e58c96e5ae9ee8b7b5><span>字节跳动 Go RPC 框架 Kitex 性能优化实践</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhblog20210907e5ad97e88a82e8b7b3e58aa8e5bc80e6ba90e58685e983a8e5beaee69c8de58aa1e4b8ade997b4e4bbb6-cloudwego-li><a href=/zh/blog/2021/09/07/%E5%AD%97%E8%8A%82%E8%B7%B3%E5%8A%A8%E5%BC%80%E6%BA%90%E5%86%85%E9%83%A8%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%B8%AD%E9%97%B4%E4%BB%B6-cloudwego/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhblog20210907e5ad97e88a82e8b7b3e58aa8e5bc80e6ba90e58685e983a8e5beaee69c8de58aa1e4b8ade997b4e4bbb6-cloudwego><span>字节跳动开源内部微服务中间件 CloudWeGo</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-zhblogreleases-li><a href=/zh/blog/releases/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-zhblogreleases><span>发布</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-zhblogreleaseskitex-li><a href=/zh/blog/releases/kitex/ title="Kitex Release" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-zhblogreleaseskitex><span>Kitex</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhblog20220602kitex-v032-e78988e69cace58f91e5b883-li><a href=/zh/blog/2022/06/02/kitex-v0.3.2-%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83/ title="Kitex v0.3.2 版本发布" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhblog20220602kitex-v032-e78988e69cace58f91e5b883><span>Release v0.3.2</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhblog20220429kitex-v030-e78988e69cace58f91e5b883-li><a href=/zh/blog/2022/04/29/kitex-v0.3.0-%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83/ title="Kitex v0.3.0 版本发布" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhblog20220429kitex-v030-e78988e69cace58f91e5b883><span>Release v0.3.0</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhblog20220324kitex-v021-e78988e69cace58f91e5b883-li><a href=/zh/blog/2022/03/24/kitex-v0.2.1-%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83/ title="Kitex v0.2.1 版本发布" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhblog20220324kitex-v021-e78988e69cace58f91e5b883><span>Release v0.2.1</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhblog20220224kitex-v020-e78988e69cace58f91e5b883-li><a href=/zh/blog/2022/02/24/kitex-v0.2.0-%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83/ title="Kitex v0.2.0 版本发布" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhblog20220224kitex-v020-e78988e69cace58f91e5b883><span>Release v0.2.0</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhblog20220118kitex-v014-e78988e69cace58f91e5b883-li><a href=/zh/blog/2022/01/18/kitex-v0.1.4-%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83/ title="Kitex v0.1.4 版本发布" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhblog20220118kitex-v014-e78988e69cace58f91e5b883><span>Release v0.1.4</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhblog20211230kitex-v013-e78988e69cace58f91e5b883-li><a href=/zh/blog/2021/12/30/kitex-v0.1.3-%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83/ title="Kitex v0.1.3 版本发布" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhblog20211230kitex-v013-e78988e69cace58f91e5b883><span>Release v0.1.3</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhblog20211222kitex-v012-e78988e69cace58f91e5b883-li><a href=/zh/blog/2021/12/22/kitex-v0.1.2-%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83/ title="Kitex v0.1.2 版本发布" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhblog20211222kitex-v012-e78988e69cace58f91e5b883><span>Release v0.1.2</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhblog20211213kitex-v010-e78988e69cace58f91e5b883-li><a href=/zh/blog/2021/12/13/kitex-v0.1.0-%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83/ title="Kitex v0.1.0 版本发布" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhblog20211213kitex-v010-e78988e69cace58f91e5b883><span>Release v0.1.0</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhblog20211105kitex-v008-e78988e69cace58f91e5b883-li><a href=/zh/blog/2021/11/05/kitex-v0.0.8-%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83/ title="Kitex v0.0.8 版本发布" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhblog20211105kitex-v008-e78988e69cace58f91e5b883><span>Release v0.0.8</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhblog20210926kitex-v005-e78988e69cace58f91e5b883-li><a href=/zh/blog/2021/09/26/kitex-v0.0.5-%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83/ title="Kitex v0.0.5 版本发布" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhblog20210926kitex-v005-e78988e69cace58f91e5b883><span>Release v0.0.5</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhblog20210826kitex-v004-e78988e69cace58f91e5b883-li><a href=/zh/blog/2021/08/26/kitex-v0.0.4-%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83/ title="Kitex v0.0.4 版本发布" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhblog20210826kitex-v004-e78988e69cace58f91e5b883><span>Release v0.0.4</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhblog20210801kitex-v003-e78988e69cace58f91e5b883-li><a href=/zh/blog/2021/08/01/kitex-v0.0.3-%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83/ title="Kitex v0.0.3 版本发布" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhblog20210801kitex-v003-e78988e69cace58f91e5b883><span>Release v0.0.3</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhblog20210730kitex-v002-e78988e69cace58f91e5b883-li><a href=/zh/blog/2021/07/30/kitex-v0.0.2-%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83/ title="Kitex v0.0.2 版本发布" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhblog20210730kitex-v002-e78988e69cace58f91e5b883><span>Release v0.0.2</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhblog20210712kitex-v001-e78988e69cace58f91e5b883-li><a href=/zh/blog/2021/07/12/kitex-v0.0.1-%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83/ title="Kitex v0.0.1 版本发布" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhblog20210712kitex-v001-e78988e69cace58f91e5b883><span>Release v0.0.1</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-zhblogreleasesnetpoll-li><a href=/zh/blog/releases/netpoll/ title="Netpoll Release" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-zhblogreleasesnetpoll><span>Netpoll</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhblog20220428netpoll-v022-e78988e69cace58f91e5b883-li><a href=/zh/blog/2022/04/28/netpoll-v0.2.2-%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83/ title="Netpoll v0.2.2 版本发布" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhblog20220428netpoll-v022-e78988e69cace58f91e5b883><span>Release v0.2.2</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhblog20220222netpoll-v020-e78988e69cace58f91e5b883-li><a href=/zh/blog/2022/02/22/netpoll-v0.2.0-%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83/ title="Netpoll v0.2.0 版本发布" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhblog20220222netpoll-v020-e78988e69cace58f91e5b883><span>Release v0.2.0</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhblog20211213netpoll-v012-e78988e69cace58f91e5b883-li><a href=/zh/blog/2021/12/13/netpoll-v0.1.2-%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83/ title="Netpoll v0.1.2 版本发布" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhblog20211213netpoll-v012-e78988e69cace58f91e5b883><span>Release v0.1.2</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhblog20211209netpoll-v011-e78988e69cace58f91e5b883-li><a href=/zh/blog/2021/12/09/netpoll-v0.1.1-%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83/ title="Netpoll v0.1.1 版本发布" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhblog20211209netpoll-v011-e78988e69cace58f91e5b883><span>Release v0.1.1</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhblog20211201netpoll-v010-e78988e69cace58f91e5b883-li><a href=/zh/blog/2021/12/01/netpoll-v0.1.0-%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83/ title="Netpoll v0.1.0 版本发布" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhblog20211201netpoll-v010-e78988e69cace58f91e5b883><span>Release v0.1.0</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-zhblog20210916netpoll-v004-e78988e69cace58f91e5b883-li><a href=/zh/blog/2021/09/16/netpoll-v0.0.4-%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83/ title="Netpoll v0.0.4 版本发布" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-zhblog20210916netpoll-v004-e78988e69cace58f91e5b883><span>Release v0.0.4</span></a></li></ul></li></ul></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/cloudwego/cloudwego.github.io/edit/main/content/zh/blog/news/Evolution_Kitex_HighPerformance/index.md target=_blank><i class="fa fa-edit fa-fw"></i> 编辑此页</a>
<a href="https://github.com/cloudwego/cloudwego.github.io/new/main/content/zh/blog/news/Evolution_Kitex_HighPerformance/index.md?filename=change-me.md&value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" target=_blank><i class="fa fa-edit fa-fw"></i> 添加子页面</a>
<a href="https://github.com/cloudwego/cloudwego.github.io/issues/new?title=%e5%ad%97%e8%8a%82%e5%be%ae%e6%9c%8d%e5%8a%a1%e6%a1%86%e6%9e%b6%e7%9a%84%e6%8c%91%e6%88%98%e5%92%8c%e6%bc%94%e8%bf%9b" target=_blank><i class="fab fa-github fa-fw"></i> 提交文档问题</a>
<a href=https://github.com/cloudwego/kitex/issues/new target=_blank><i class="fas fa-tasks fa-fw"></i> 提交项目问题</a></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#kite-的缺陷>Kite 的缺陷</a></li><li><a href=#kitex>Kitex</a></li><li><a href=#面向开源>面向开源</a></li><li><a href=#kitex-的功能特性>Kitex 的功能特性</a><ul><li><a href=#治理能力>治理能力</a></li><li><a href=#多协议>多协议</a></li><li><a href=#代码生成工具>代码生成工具</a></li></ul></li><li><a href=#kitex-的性能表现>Kitex 的性能表现</a></li><li><a href=#kitex一个-demo>Kitex：一个 demo</a></li></ul><ul><li><a href=#与内部基础设施的集成>与内部基础设施的集成</a></li><li><a href=#内部落地的经典案例合并部署>内部落地的经典案例：合并部署</a></li><li><a href=#微服务框架推进的痛点>微服务框架推进的痛点</a></li><li><a href=#kitex-在字节内部的发展>Kitex 在字节内部的发展</a></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 pl-md-5 pr-md-4" role=main><div class=td-content><h1>字节微服务框架的挑战和演进</h1><div class="td-byline mb-4">By <b><a href=https://github.com/lsjbd target=_blank>lsjbd</a></b> |
<time datetime=2022-05-19 class=text-muted>Thursday, May 19, 2022</time></div><header class=article-meta></header><h1 id=字节微服务框架的挑战和演进>字节微服务框架的挑战和演进</h1><p>2014 年以来，字节跳动内部业务的快速发展，推动了长连接推送服务，它们面临着高并发的业务需求问题，对性能和开发效率都有很高要求。当时的业务，大部分都是由 Python 开发，难以应对新出现的问题。项目负责人在一众现存的技术栈中选择了 Golang 这一门新兴的编程语言，快速解决了性能和开发效率的问题。随后，字节跳动内部开始逐渐推广使用 Golang 进行服务开发。</p><p>2016 年， 第一代 Golang RPC 框架 Kite 正式发布。Kite 是一个基于 Apache Thrift 进行包装的 RPC 框架，它在 Facebook 开源的 Thrift 之上提供了结合字节跳动内部基础设施的治理功能，同时还提供了一套简单易用的生成工具。随着 Kite 的发展，业务开始大规模使用 Golang。然而，在业务发展的过程中，由于研发专注于实现业务需求，对于框架的可维护性考量不足，Kite 逐渐背上了一些技术包袱，越来越难以满足业务在高性能和新特性方面的需求。因此我们决定对 Kite 进行重新设计，于是出现了 Kitex。</p><p>2020 年，Kitex 在内部发布了 v1.0.0，并且直接接入了 1,000+ 服务。由于 Kitex 的优秀性能和易用性，Kitex 在内部得到了大规模发展。直到 2021 年年中，字节跳动内部已有 2w+ 服务使用了 Kitex。因此，我们决定全面优化 Kitex，将其实践成果进行开源，反馈给开源社区。</p><p><img src=/img/blog/Evolution_Kitex_High-performance/GolangRPC.png alt=image></p><p align=center>字节跳动 Golang RPC 框架的演进</p><h2 id=kite-的缺陷>Kite 的缺陷</h2><p>Kite 作为字节跳动第一代 Golang RPC 框架，主要存在以下缺陷：</p><ol><li>Kite 为了快速支持业务发展需求，不可避免地耦合了部分中台业务的功能；</li><li>Kite 对 Go modules 支持不友好（Go modules 在 2019 年才进入语言核心）；</li><li>Kite 自身的代码拆分成多仓库，版本更新时推动业务升级困难；</li><li>Kite 强耦合了早期版本的 Apache Thrift，协议和功能拓展困难；</li><li>Kite 的生成代码逻辑与框架接口强耦合，成为了性能优化的天花板。</li></ol><p>因此，业务的快速发展和需求场景的多样化，催生了新一代 Golang RPC 框架 Kitex。</p><h2 id=kitex>Kitex</h2><p>Kitex 的架构主要包括四个部分：Kitex Tool、Kitex Core、Kitex Byted、Second Party Pkg。</p><ul><li>Kitex Core 是一个携带了一套微服务治理功能的 RPC 框架，它是 Kitex 的核心部分。</li><li>Kitex Byted 是一套结合了字节跳动内部基础设施的拓展集合。通过这一套拓展集合，Kitex 能够在内部支持业务的发展。</li><li>Kitex Tool 是一个命令行工具，能够在命令行生成我们的代码以及服务的脚手架，可以提供非常便捷的开发体验。</li><li>Second Party Pkg，例如 Netpoll， Netpoll-http2，是 Kitex 底层的网络库，这两个库也开源在 CloudWeGo 组织中。</li></ul><p><img src=/img/blog/Evolution_Kitex_High-performance/Architecture_design.png alt=image></p><p align=center>Kitex 的架构设计</p><p>总的来说， Kitex 主要有五个特点：面向开源、功能丰富、灵活可拓展、支持多协议、高性能。</p><h2 id=面向开源>面向开源</h2><p>由于之前已经体验过了 Kite 维护的各种问题，我们在立项之初就考虑到了未来可能会开源 Kitex。因此，我们设计的第一个宗旨就是不将 Kitex 和公司内部的基础设施进行强耦合或者硬编码绑定。Kitex Core 是一个非常简洁的框架，公司内部的所有基础设施都以拓展的方式注入到 Kitex Core 里。即使我们现在已经开源了，它也以这种形式存在。公司内部基础设施的更新换代，和 Kitex 自身的迭代是相互独立的，这对于业务来说是非常好的体验。同时，在 Kitex 的接口设计上，我们使用了 Golang 经典的 Option 模式，它是可变参数，通过 Option 能够提供各种各样的功能，这为我们的开发和业务的使用都带来了非常大的灵活性。</p><h2 id=kitex-的功能特性>Kitex 的功能特性</h2><h3 id=治理能力>治理能力</h3><p>Kitex 内置了丰富的服务治理能力，例如超时熔断、重试、负载均衡、泛化调用、数据透传等功能。业务或者外部的用户使用 Kitex 都是可以开箱即用的。如果你有非常特殊的需求，你也可以通过我们的注入点去进行定制化操作，比如你可以自定义中间件去过滤或者拦截请求，定义跟踪器去注入日志、去注入服务发现等。在 Kitex 中，几乎一切跟策略相关的东西都是可以定制的。</p><p>以服务发现为例，Kitex 的核心库里定义了一个 Resolver interface 。任何一个实现了这四个方法的类型都可以作为一个服务发现的组件，然后注入到 Kitex 来取代 Kitex 的服务发现功能。在使用时，客户端只需要创建一个 Resolver 的对象，然后通过 client.WithResolver 注入客户端，就可以使用自己开发的服务发现组件。</p><p><img src=/img/blog/Evolution_Kitex_High-performance/Resolver.png alt=image></p><p>Kitex 的一个创新之处是使用 Suite 来打包自定义的功能，提供一键配置基础依赖的体验。</p><p>它能在什么地方起作用呢？例如，一个外部企业想要启用或者接入 Kitex， 它不可能拥有字节跳动内部的所有基础设施。那么企业在使用的时候肯定需要定制化，他可能需要定义自己的注册中心、负载均衡、连接池等等。如果业务方要使用这些功能的话，就需要加入非常非常多的参数。而 Suite 可以通过一个简单的类一次性包装这些功能，由此，业务方使用时，仍然是以单一的参数的方式添加，十分方便。又例如，我现在开发一个叫 mysuite 的东西，我可能提供一个特殊的服务发现功能，提供了一个拦截的中间件，还有负载均衡功能等。业务方使用时，不需要感知很多东西去配置，只需要添加一个 Suite 就足够了，这点非常方便一些中台方或者第三方去做定制。</p><p><img src=/img/blog/Evolution_Kitex_High-performance/Suite.png alt=image></p><p align=center>示例</p><h3 id=多协议>多协议</h3><p>Kitex 网络层基于高性能网络库 Netpoll 实现。在 Netpoll 上，我们构建了 Thrift 和 Netpoll-http2；在 Thrift 上，我们还做了一些特殊的定制，例如，支持 Thrift 的泛化调用，还有基于 Thrift 的连接多路复用。</p><p><img src=/img/blog/Evolution_Kitex_High-performance/Multi-protocol.png alt=image></p><p align=center>多协议</p><h3 id=代码生成工具>代码生成工具</h3><p>和 Kitex 一同出现的，还有我们开发的一个简单易用的命令行工具。如果我们写了一个 IDL， 只需要提供一个 module 参数和一个服务名称，Kitex 就会为你生成服务代码脚手架。</p><p>目前 Kitex 支持了 Protobuf 和 Thrift 这两种 IDL 的定义。命令行工具内置丰富的选项，可以进行项目代码定制；同时，它底层依赖 Protobuf 官方的编译器，和我们自研的 Thriftgo 的编译器，两者都支持自定义的生成代码插件。</p><h2 id=kitex-的性能表现>Kitex 的性能表现</h2><p>字节跳动内部 RPC 框架使用的协议主要都是基于 Thrift，所以我们在 Thrift 上深耕已久。结合自研的 netpoll 能力，它可以直接暴露底层连接的 buffer。在此基础上，我们设计出了 FastRead/FastWrite 编解码实现，测试发现它具有远超过 apache thrift 生成代码的性能。整体而言，Kitex 的性能相当不错，今年 1 月份的数据如下图所示，可以看到，Kitex 在使用 Thrift 作为 Payload 的情况下，性能优于官方 gRPC，吞吐接近 gRPC 的两倍；此外，在 Kitex 使用定制的 Protobuf 协议时，性能也优于 gRPC。</p><p><img src=/img/blog/Evolution_Kitex_High-performance/Kitex_gRPC.png alt=image></p><p align=center>Kitex/gRPC 性能对比（2022 年 1 月数据）</p><h2 id=kitex一个-demo>Kitex：一个 demo</h2><p>下面简单演示一下 Kitex 是如何开发一个服务的。</p><p>首先，定义 IDL。这里使用 Thrift 作为 IDL 的定义，编写一个名为 Demo 的 service。方法 Test 的参数是 String，它的返回也是 String。编写完这个 demo.thrift 文件之后，就可以使用 Kitex 在命令行生成指定的生成代码。如图所示，只需要传入 module name，service name 和目标 IDL 就行了。</p><p><img src=/img/blog/Evolution_Kitex_High-performance/IDL.png alt=image></p><p align=center>定义 IDL</p><p>随后，我们需要填充业务逻辑。文件中除了第 12 行，全部代码都是 Kitex 命令行工具生成的。通常一个 RPC 方法需要返回一个 Response，例如这里需要返回一个字符串，那么我们给 Response 赋值即可。接下来需要通过 go mod tidy 把依赖拉下来，然后用 build.sh 构建，就可以启动服务了。Kitex 默认的接听端口是 8888。</p><p><img src=/img/blog/Evolution_Kitex_High-performance/Handler.png alt=image></p><p align=center>定义 Handler 方法</p><p><img src=/img/blog/Evolution_Kitex_High-performance/Compile_run.png alt=image></p><p align=center>编译、运行</p><p>对于刚刚启动的服务端，我们可以写一个简单的客户端去调用它。服务端写完之后，写客户端也是非常方便的。这里同样是 import 刚刚生成的生成代码，创建 Client、指定服务名字、构成相应的参数，填上“ Hello，word！” ，然后就可以调用了。</p><p><img src=/img/blog/Evolution_Kitex_High-performance/Client.png alt=image></p><p align=center>编写 Client</p><h1 id=kitex-在字节内部的落地>Kitex 在字节内部的落地</h1><h2 id=与内部基础设施的集成>与内部基础设施的集成</h2><p>谈到落地，第一步就是 Kitex 和字节跳动内部的基础设施进行结合。字节跳动内部的所有基础设施都是以依赖的方式注入到 Kitex 的。我们将日志、监控、tracing 都定义为 tracer，然后通过 WithTracer 这个 Option 将其注入到 Kitex 里；服务发现是 WithResolver；Service Mesh 则是 WithProxy 等。字节跳动内部的基础设施都是通过 Option 被注入到 Kitex 的，而且所有的 Option 都是通过前面说的 Suite 打包，简单地添加到业务的代码里完成。</p><p><img src=/img/blog/Evolution_Kitex_High-performance/Integration.png alt=image></p><p align=center>与内部基础设施的集成</p><h2 id=内部落地的经典案例合并部署>内部落地的经典案例：合并部署</h2><p>这里介绍一个内部落地的经典案例：合并部署。其背景是，在开发微服务时，由于业务拆分和业务场景的多样化，微服务容易出现过微的情况。当服务数量越来越多，网络传输和序列化开销就会越来越大，变得不可忽视。因此，Kitex 框架需要考虑如何减小网络传输和序列化的开销。</p><p>字节跳动基础架构经过一系列的探索和实践，最终推出了合并部署的机制。<strong>它的思路</strong>是：将有强依赖关系的服务进行同机部署，减少它们之间的调用开销。理论上说起来比较简单，实际过程中需要非常多的组件进行配合。</p><p><strong>Kitex 的做法</strong>是：首先，它会依赖一套中心化的部署调度和流量控制；其次，我们开发了一套基于共享内存的通信协议，它可以使得我们两个不同的服务在同一台机器部署时，不需要通过网络进行数据传输，直接通过共享内存，减少额外的数据拷贝。</p><p>在服务合并部署的模式下，我们需要特殊的服务发现和连接池的实现、定制化的服务启动和监听逻辑。这些在 Kitex 框架里都是通过依赖注入的方式给添加进来的。Kitex 服务在启动过程中会感知到我们 PaaS 平台提供的指定的环境变量。当它察觉到自己需要按合并部署的方式启动之后，就会启动一个预先注入的特定 Suite，随后将相应的功能全都添加进来再启动，就可以执行我们的合并部署。</p><p>那么，它的效果如何呢？在 2021 年的实践过程中，我们对抖音的某个服务约 30% 的流量进行了合并，服务端的 CPU 的消耗减少了 19%， TP99 延迟下降到 29%，效果相当显著。</p><p><img src=/img/blog/Evolution_Kitex_High-performance/Merge_deployment.png alt=image></p><p align=center>内部落地的经典案例：合并部署</p><h2 id=微服务框架推进的痛点>微服务框架推进的痛点</h2><ul><li>升级慢</li></ul><p>大家可能好奇 Kitex 在字节跳动内部推广是不是很顺畅？其实并不是。作为一个相对而言比较新的框架， Kitex 和其它新生项目一样，在推广的过程中都会遇到同样的问题。特别是， Kitex 作为一个 RPC 框架，我们提供给用户的其实是一个代码的 SDK, 我们的更新是需要业务方的用户去感知、升级、部署上线，才能最终体现在他们的服务逻辑里，因此具有升级慢的问题。</p><ul><li>召回慢</li></ul><p>同时，因为代码都是由研发人员编写，如果代码出现了 bug，我们就需要及时地去感知定位问题，通知负责人去更新版本。因此，会有召回慢的问题。</p><ul><li>问题排查困难</li></ul><p>业务方的用户在写代码时，他们其实往往关注的是自己的业务逻辑，他们不会深入理解一个框架内部的实现。所以如果出现问题，他们往往会不知所措，需要依赖我们的业务同学才能进行相应的问题排查。所以会有问题排查困难的问题。</p><p>针对<strong>升级慢</strong>，我们有两个操作。一是，代码生成工具支持自动更新：当用户在使用时，我们会检查最新版本，然后直接将我们的版本更新到最新版本，这样可以及时把我们的框架新 feature、bug fix 直接推送到业务方；二是，用户群发版周知：我们有一个几千人的用户群，当有了新版本，我们会在用群里周知，可以最大范围的覆盖到我们的目标用户。</p><p>针对<strong>召回慢</strong>，我们有三个操作。一是，我们在线上建立完整的版本分布统计，监控所有服务上线部署的框架的版本；二是，我们会跟 PaaS 平台合作，在服务上线时进行卡点操作，检查它们使用的框架版本是不是有 bug，是否需要拦截；三是，针对有问题的版本，我们会及时封禁，及时推动用户更新。</p><p>针对<strong>问题排查困难</strong>，我们有两个操作。一是，我们积累了非常丰富的 Wiki 和问题排查手册，例如超时问题、 协议解析问题等。二是，如果遇到难以解决的问题，我们在线上服务默认开启了 Debug 端口，保证框架开发同学可以第一时间赶到现场去排查。</p><h2 id=kitex-在字节内部的发展>Kitex 在字节内部的发展</h2><p>数据显示，在 2020 年，v1.0 版本发布的初始阶段，用户的接受度比较低。直到 2020 年 6 月，线上接受 Kitex 的数量还不到 1000。随后进入快速发展的阶段，到 2021 年年初，累积接近 1w+ 的服务开始使用 Kitex。2021 年底，4w+服务使用 Kitex。</p><p><img src=/img/blog/Evolution_Kitex_High-performance/Number_of_AccessServices.png alt=image></p><h1 id=kitex-的开源实践>Kitex 的开源实践</h1><p>开源工作主要包括代码、文档和社区运营三个层面。</p><p><strong>代码层面</strong></p><ul><li>代码拆分、脱敏；</li><li>内部仓库引用开源仓库，避免内外多副本同时维护；</li><li>在开源过程中确保内部用户平滑切换、体验无损；</li></ul><p><strong>文档层面</strong></p><ul><li>重新梳理用户文档，覆盖方方面面；</li><li>建立详尽的用例仓库(CloudWeGo/Kitex-examples)。</li></ul><p><strong>社区运营</strong></p><ul><li>官网建设；</li><li>组建用户群，进行答疑解惑；</li><li>飞书机器人对接 Github 的 Issue 管理、PR 管理之类的业务，可以快速响应；</li><li>对优秀贡献者进行奖励。</li></ul><p>在以上努力下，CloudWeGo/Kitex 仓库目前收获了 4.1k+ stars；Kitex-Contrib 获得多个外部用户贡献的仓库；CloudWeGo 飞书用户群近 950 个用户……</p><h1 id=未来展望>未来展望</h1><p>首先，我们仍然会持续向开源社区反馈最新的技术进展。例如在 Thrift 协议上，虽然对 Thrift 的编解码已经做到非常极致的优化了，我们还在探索利用 JIT 手段来提供更多的性能提升；在 Protobuf 上，我们会补足短板，将在 Thrift 方面的优化经验迁移到 Protobuf 上，对 Protobuf 的生成代码和编解码进行优化；Kitex 后续也会进一步融入云原生社区，所以也在考虑支持 xDS 协议。其次，我们会去拓展更多的开源组件，去对接现存的云原生社区的各种常用的或者热门组件。最后，我们也会尝试去对接更多的公有云基础设施，使得用户在公有云上使用 Kitex 时能够拥有愉悦的体验。</p><ul class="list-unstyled d-flex justify-content-between align-items-center mb-0 pt-5"><li><a href=/zh/blog/2022/04/01/cloudwego-%E5%8A%A9-nextarch-%E5%9F%BA%E9%87%91%E4%BC%9A%E6%8E%A8%E5%8A%A8%E6%A0%87%E5%87%86%E5%8C%96%E5%BB%BA%E8%AE%BE/ aria-label="上一页 - CloudWeGo 助 NextArch 基金会推动标准化建设" class="btn btn-primary"><span class=mr-1>←</span> 上一页</a></li><a href=/zh/blog/2022/05/26/%E4%BB%8E-cloudwego-%E8%B0%88%E4%BA%91%E5%8E%9F%E7%94%9F%E6%97%B6%E4%BB%A3%E7%9A%84%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%B8%8E%E5%BC%80%E6%BA%90/ aria-label="下一页 - 从 CloudWeGo 谈云原生时代的微服务与开源" class="btn btn-primary">下一页 <span class=ml-1>→</span></a></li></ul></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2022 The CloudWeGo Authors</small><p class="mt-2 text-white"><a class=cloudwego-link href=/about/ target=_blank rel=noopener>About</a>
|
<a class=cloudwego-link href=https://github.com/cloudwego/cloudwego.github.io/blob/main/LICENSE target=_blank rel=noopener>License</a></p></div></div></div></footer></div><script src=https://cdn.staticfile.org/popper.js/1.16.1/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script><script src=https://cdn.staticfile.org/bootstrap/4.6.0/js/bootstrap.min.js integrity=sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF crossorigin=anonymous></script><script src=/js/main.min.5c74b870c6953931a705f390a49c7e4c0a842ec5c83b24354758dd674343ed0d.js integrity="sha256-XHS4cMaVOTGnBfOQpJx+TAqELsXIOyQ1R1jdZ0ND7Q0=" crossorigin=anonymous></script></body></html>