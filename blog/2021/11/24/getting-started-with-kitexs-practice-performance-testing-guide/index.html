<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.85.0"><meta name=ROBOTS content="INDEX, FOLLOW"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Getting Started With Kitex's Practice: Performance Testing Guide | CloudWeGo</title><meta name=description content="A leading practice for building enterprise cloud native middleware!"><meta property="og:title" content="Getting Started With Kitex's Practice: Performance Testing Guide"><meta property="og:description" content="On September 8, 2021, ByteDance announced the launch of CloudWeGo open source project. CloudWeGo is a set of microservice middleware developed by ByteDance with high performance, strong scalability and stability. It focuses on microservice communication and governance, and meets the demands of different services in various scenarios. CloudWeGo currently has 4 Repos: Kitex, Netpoll, Thriftgo and netpoll-http2, featuring the RPC framework &ndash; Kitex and the network library &ndash; Netpoll."><meta property="og:type" content="article"><meta property="og:url" content="/blog/2021/11/24/getting-started-with-kitexs-practice-performance-testing-guide/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2021-11-24T00:00:00+00:00"><meta property="article:modified_time" content="2022-06-16T18:11:04+08:00"><meta property="og:site_name" content="CloudWeGo"><meta itemprop=name content="Getting Started With Kitex's Practice: Performance Testing Guide"><meta itemprop=description content="On September 8, 2021, ByteDance announced the launch of CloudWeGo open source project. CloudWeGo is a set of microservice middleware developed by ByteDance with high performance, strong scalability and stability. It focuses on microservice communication and governance, and meets the demands of different services in various scenarios. CloudWeGo currently has 4 Repos: Kitex, Netpoll, Thriftgo and netpoll-http2, featuring the RPC framework &ndash; Kitex and the network library &ndash; Netpoll."><meta itemprop=datePublished content="2021-11-24T00:00:00+00:00"><meta itemprop=dateModified content="2022-06-16T18:11:04+08:00"><meta itemprop=wordCount content="1207"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Getting Started With Kitex's Practice: Performance Testing Guide"><meta name=twitter:description content="On September 8, 2021, ByteDance announced the launch of CloudWeGo open source project. CloudWeGo is a set of microservice middleware developed by ByteDance with high performance, strong scalability and stability. It focuses on microservice communication and governance, and meets the demands of different services in various scenarios. CloudWeGo currently has 4 Repos: Kitex, Netpoll, Thriftgo and netpoll-http2, featuring the RPC framework &ndash; Kitex and the network library &ndash; Netpoll."><script async src="https://www.googletagmanager.com/gtag/js?id=G-QYWRQRLPRM"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-QYWRQRLPRM')</script><link rel=preload href=/scss/main.min.f95524309453418871a413b9a587face83fc966617fd43915c481936076f7a1d.css as=style><link href=/scss/main.min.f95524309453418871a413b9a587face83fc966617fd43915c481936076f7a1d.css rel=stylesheet integrity><script src=https://cdn.staticfile.org/jquery/3.5.1/jquery.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','G-QYWRQRLPRM','auto'),ga('send','pageview'))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class="td-page td-blog"><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/><span class=navbar-logo><img src=/img/logo.png></span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="dropdown sub-menu"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false><span>Documentation</span></a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/docs/kitex/>Kitex</a>
<a class=dropdown-item href=/docs/hertz/>Hertz</a>
<a class=dropdown-item href=/docs/netpoll/>Netpoll</a></div></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/about/><span>About</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/blog/><span class=active>Blog</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/community/><span>Community</span></a></li><li class="nav-item dropdown mr-4 d-none d-lg-block"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>English</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/zh/>中文</a></div></li></ul></div><div class="navbar-nav d-none d-lg-block"></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><div id=content-mobile><form class="td-sidebar__search d-flex align-items-center"><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation"></button></form></div><div id=content-desktop></div><nav class="collapse td-sidebar-nav" id=td-section-nav><div class="nav-item dropdown d-block d-lg-none"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>English</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/zh/>中文</a></div></div><ul class="td-sidebar-nav__section pr-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-blog-li><a href=/blog/ title="Docsy Blog" class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-blog><span>Blog</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-blognews-li><a href=/blog/news/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-blognews><span>News</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20220325an-article-to-learn-about-bytedance-microservices-middleware-cloudwego-li><a href=/blog/2022/03/25/an-article-to-learn-about-bytedance-microservices-middleware-cloudwego/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20220325an-article-to-learn-about-bytedance-microservices-middleware-cloudwego><span>An Article to Learn About ByteDance Microservices Middleware CloudWeGo</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-blog20211124getting-started-with-kitexs-practice-performance-testing-guide-li><a href=/blog/2021/11/24/getting-started-with-kitexs-practice-performance-testing-guide/ class="align-left pl-0 active td-sidebar-link td-sidebar-link__page" id=m-blog20211124getting-started-with-kitexs-practice-performance-testing-guide><span class=td-sidebar-nav-active-item>Getting Started With Kitex's Practice: Performance Testing Guide</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20211009bytedance-practices-on-go-network-library-li><a href=/blog/2021/10/09/bytedance-practices-on-go-network-library/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20211009bytedance-practices-on-go-network-library><span>ByteDance Practices on Go Network Library</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20210923performance-optimization-on-kitex-li><a href=/blog/2021/09/23/performance-optimization-on-kitex/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20210923performance-optimization-on-kitex><span>Performance Optimization on Kitex</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20210913cloudwego-open-source-announcement-li><a href=/blog/2021/09/13/cloudwego-open-source-announcement/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20210913cloudwego-open-source-announcement><span>CloudWeGo Open Source Announcement</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-blogreleases-li><a href=/blog/releases/ title="New Releases" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-blogreleases><span>Releases</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-blogreleaseskitex-li><a href=/blog/releases/kitex/ title="Kitex Release" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-blogreleaseskitex><span>Kitex</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20220602kitex-release-v032-li><a href=/blog/2022/06/02/kitex-release-v0.3.2/ title="Kitex Release v0.3.2" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20220602kitex-release-v032><span>Release v0.3.2</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20220429kitex-release-v030-li><a href=/blog/2022/04/29/kitex-release-v0.3.0/ title="Kitex Release v0.3.0" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20220429kitex-release-v030><span>Release v0.3.0</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20220324kitex-release-v021-li><a href=/blog/2022/03/24/kitex-release-v0.2.1/ title="Kitex Release v0.2.1" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20220324kitex-release-v021><span>Release v0.2.1</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20220224kitex-release-v020-li><a href=/blog/2022/02/24/kitex-release-v0.2.0/ title="Kitex Release v0.2.0" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20220224kitex-release-v020><span>Release v0.2.0</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20220118kitex-release-v014-li><a href=/blog/2022/01/18/kitex-release-v0.1.4/ title="Kitex Release v0.1.4" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20220118kitex-release-v014><span>Release v0.1.4</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20211230kitex-release-v013-li><a href=/blog/2021/12/30/kitex-release-v0.1.3/ title="Kitex Release v0.1.3" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20211230kitex-release-v013><span>Release v0.1.3</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20211222kitex-release-v012-li><a href=/blog/2021/12/22/kitex-release-v0.1.2/ title="Kitex Release v0.1.2" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20211222kitex-release-v012><span>Release v0.1.2</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20211213kitex-release-v010-li><a href=/blog/2021/12/13/kitex-release-v0.1.0/ title="Kitex Release v0.1.0" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20211213kitex-release-v010><span>Release v0.1.0</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20211105kitex-release-v008-li><a href=/blog/2021/11/05/kitex-release-v0.0.8/ title="Kitex Release v0.0.8" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20211105kitex-release-v008><span>Release v0.0.8</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20210926kitex-release-v005-li><a href=/blog/2021/09/26/kitex-release-v0.0.5/ title="Kitex Release v0.0.5" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20210926kitex-release-v005><span>Release v0.0.5</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20210826kitex-release-v004-li><a href=/blog/2021/08/26/kitex-release-v0.0.4/ title="Kitex Release v0.0.4" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20210826kitex-release-v004><span>Release v0.0.4</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20210801kitex-release-v003-li><a href=/blog/2021/08/01/kitex-release-v0.0.3/ title="Kitex Release v0.0.3" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20210801kitex-release-v003><span>Release v0.0.3</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20210730kitex-release-v002-li><a href=/blog/2021/07/30/kitex-release-v0.0.2/ title="Kitex Release v0.0.2" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20210730kitex-release-v002><span>Release v0.0.2</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20210712kitex-release-v001-li><a href=/blog/2021/07/12/kitex-release-v0.0.1/ title="Kitex Release v0.0.1" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20210712kitex-release-v001><span>Release v0.0.1</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-blogreleasesnetpoll-li><a href=/blog/releases/netpoll/ title="Netpoll Release" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-blogreleasesnetpoll><span>Netpoll</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20220428netpoll-release-v022-li><a href=/blog/2022/04/28/netpoll-release-v0.2.2/ title="Netpoll Release v0.2.2" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20220428netpoll-release-v022><span>Release v0.2.2</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20220222netpoll-release-v020-li><a href=/blog/2022/02/22/netpoll-release-v0.2.0/ title="Netpoll Release v0.2.0" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20220222netpoll-release-v020><span>Release v0.2.0</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20211213netpoll-release-v012-li><a href=/blog/2021/12/13/netpoll-release-v0.1.2/ title="Netpoll Release v0.1.2" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20211213netpoll-release-v012><span>Release v0.1.2</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20211209netpoll-release-v011-li><a href=/blog/2021/12/09/netpoll-release-v0.1.1/ title="Netpoll Release v0.1.1" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20211209netpoll-release-v011><span>Release v0.1.1</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20211201netpoll-release-v010-li><a href=/blog/2021/12/01/netpoll-release-v0.1.0/ title="Netpoll Release v0.1.0" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20211201netpoll-release-v010><span>Release v0.1.0</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blog20210916netpoll-release-v004-li><a href=/blog/2021/09/16/netpoll-release-v0.0.4/ title="Netpoll Release v0.0.4" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blog20210916netpoll-release-v004><span>Release v0.0.4</span></a></li></ul></li></ul></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/cloudwego/cloudwego.github.io/edit/main/content/en/blog/news/kitex_performance_testing/index.md target=_blank><i class="fa fa-edit fa-fw"></i> Edit this page</a>
<a href="https://github.com/cloudwego/cloudwego.github.io/new/main/content/en/blog/news/kitex_performance_testing/index.md?filename=change-me.md&value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" target=_blank><i class="fa fa-edit fa-fw"></i> Create child page</a>
<a href="https://github.com/cloudwego/cloudwego.github.io/issues/new?title=Getting%20Started%20With%20Kitex%27s%20Practice:%20Performance%20Testing%20Guide" target=_blank><i class="fab fa-github fa-fw"></i> Create documentation issue</a>
<a href=https://github.com/cloudwego/kitex/issues/new target=_blank><i class="fas fa-tasks fa-fw"></i> Create project issue</a></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#the-characteristics-of-microservice-scenario>The Characteristics of Microservice Scenario</a></li><li><a href=#stress-test-for-microservice-scenarios>Stress Test for Microservice Scenarios</a><ul><li><a href=#determine-stress-test-objects>Determine Stress Test Objects</a></li><li><a href=#alignment-of-connection-model>Alignment of Connection Model</a></li><li><a href=#alignment-of-serialization-strategy>Alignment of Serialization Strategy</a></li><li><a href=#use-exclusive-cpu>Use Exclusive CPU</a></li></ul></li><li><a href=#performance-data-demonstration>Performance Data Demonstration</a></li><li><a href=#summary>Summary</a></li><li><a href=#pertinent-links>Pertinent Links</a></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 pl-md-5 pr-md-4" role=main><div class=td-content><h1>Getting Started With Kitex's Practice: Performance Testing Guide</h1><div class="td-byline mb-4">By <b><a href=https://github.com/joway target=_blank>Joway</a></b> |
<time datetime=2021-11-24 class=text-muted>Wednesday, November 24, 2021</time></div><header class=article-meta></header><blockquote><p>On September 8, 2021, ByteDance announced the launch of CloudWeGo open source project.
CloudWeGo is a set of microservice middleware developed by ByteDance with high performance, strong scalability and stability.
It focuses on microservice communication and governance, and meets the demands of different services in various scenarios.
CloudWeGo currently has 4 Repos: Kitex, Netpoll, Thriftgo and netpoll-http2, featuring the RPC framework &ndash; Kitex and the network library &ndash; Netpoll.</p></blockquote><p>Recently, ByteDance Service Framework Team officially announced the open source of CloudWeGo. It includes the Golang microservice RPC framework &ndash; Kitex, which has been deeply used in Douyin and Toutiao.</p><p>This article aims to share the scenarios and technical issues that developers need to know when stress testing Kitex.
These guides will help users adjust and optimize Kitex to better match their business needs, and maximize Kitex&rsquo;s performance in real RPC scenarios.
Users can also refer to the official stress test project &ndash; <a href=https://github.com/cloudwego/kitex-benchmark>kitex-benchmark</a> for more details.</p><h2 id=the-characteristics-of-microservice-scenario>The Characteristics of Microservice Scenario</h2><p>Kitex was born in ByteDance&rsquo;s large-scale microservices architecture practice. The scenario it is aimed at is naturally a microservices scenario.
Therefore, the following will first introduce the characteristics of microservices, so that developers can understand Kitex&rsquo;s design thinking in depth.</p><ul><li><strong>RPC Communication Model</strong></li></ul><p>The communication between microservices is usually based on PingPong model. So, in addition to the conventional throughput performance index, developers also need to consider the average latency of each RPC.</p><ul><li><strong>Complex Call Chain</strong></li></ul><p>An RPC call often requires multiple microservices to collaborate, and downstream services have their own dependencies, so the entire call chain will be a complex network structure.</p><p>In this kind of complex call chains, the latency fluctuation of one intermediate node may be transmitted to the entire chain，resulting in an overall timeout.
When there are many nodes on the chain, even if the fluctuation probability of each node is very low, the timeout probability that eventually converges on the chain will be magnified.
Therefore, the latency fluctuation of a single service, notably P99, is also a key indicator that has a significant impact on online services.</p><ul><li><strong>Size of Data Package</strong></li></ul><p>Although the size of transmitted data packages depends on the actual business scenario, the internal statistics of ByteDance found that most online requests are small packages (&lt;2KB).
So we focused on optimizing the performance in the small data package scenarios while taking the large package scenarios into account.</p><h2 id=stress-test-for-microservice-scenarios>Stress Test for Microservice Scenarios</h2><h3 id=determine-stress-test-objects>Determine Stress Test Objects</h3><p>Measuring the performance of an RPC framework requires consideration from two perspectives: Client and Server.
In large-scale business architectures, upstream clients are not necessarily using the same frameworks as downstream, and same goes to the downstream services scheduled by developers.
The situation becomes more complicated when Service Mesh is involved.</p><p>Some stress test projects often generate performance data for the <strong>entire framework</strong> by mixing Client and Server processes, which is likely to be inconsistent with the actual online operation.</p><p>If you want to stress test Server, you should give Client as many resources as possible to push Server to its limit, and vice versa.
If both Client and Server are only provided 4-core CPUs for stress tests, it will be impossible for developers to determine the performance data is referring to either Client or Server.
Thus, the test result will not have practical value for online services.</p><h3 id=alignment-of-connection-model>Alignment of Connection Model</h3><p>Conventional RPCs have three major connection models:</p><ul><li><strong>Short connection</strong>: Each request creates a new connection and closes the connection immediately after the return is received.</li><li><strong>Persistent connection pool</strong>: A single connection can process only one complete request & return at once.</li><li><strong>Connection multiplexing</strong>: A single connection can process multiple requests & returns asynchronously at the same time.</li></ul><p>Each type of connection model is not absolutely good or bad, it depends on the actual usage scenario.
Although connection multiplexing generally performs the best, the application must rely on the protocol being able to support package serial numbers,
and some older framework services may not support multiplexing calls.</p><p>In order to ensure maximum compatibility, Kitex initially used short connections on the Client side by default, while other mainstream open source frameworks used connection multiplexing by default.
It resulted in large performance data deviations for some users when stress testing with default configuration.</p><p>Later, in order to accommodate the common scenario of open source users, Kitex supported <a href=https://github.com/cloudwego/kitex/pull/40/files>persistent connection</a> by default in v0.0.2.</p><h3 id=alignment-of-serialization-strategy>Alignment of Serialization Strategy</h3><p>For RPC frameworks, regardless of service governance, the computation overhead is mainly generated in serialization and deserialization.</p><p>Kitex uses the <a href=https://github.com/golang/protobuf>Go protobuf library</a> to serialize Protobuf.
And for serialization of Thrift, Kitex has specific performance optimization, which is introduced in the <a href=https://www.cloudwego.io/blog/2021/09/23/performance-optimization-on-kitex/#serializationdeserialization-optimization-of-thrift>blog post</a> on our official web.</p><p>Most of the current open source frameworks support Protobuf in preference, and some built-in Protobuf are actually <a href=https://github.com/gogo/protobuf>gogo/protobuf</a> versions with performance optimizations.
However, gogo/protobuf is currently at risk of <a href=https://github.com/gogo/protobuf/issues/691>maintenance absence</a>.
Therefore, due to maintainability concerns, we decided to use the official protobuf library only. Certainly, we will plan to optimize Protobuf in the future.</p><h3 id=use-exclusive-cpu>Use Exclusive CPU</h3><p>Although multiple processes would usually utilize the CPU capability at the same time for online applications.
But in stress test scenarios, both Client and Server processes are extremely busy.
Sharing the CPU will result in a large number of context switching, which makes the output data less reliable and prone to large fluctuations.</p><p>Therefore, we recommend that the Client and Server processes should be isolated on different CPUs or different exclusive machines.
If you want to further avoid the impact of other processes, you can add the nice -n -20 command to adjust the scheduling priority of the stress testing process.</p><p>In addition, if possible, using physical machines makes the test results more precise and reproducible compared to using virtual machines on cloud platforms.</p><h2 id=performance-data-demonstration>Performance Data Demonstration</h2><p>On the premise of meeting the above requirements, we compared the stress test results of multiple frameworks using Protobuf.
The stress test source code can be found in <a href=https://github.com/gogo/protobuf/issues/691>kitex-benchmark</a> repo.
When Server is fully loaded, P99 Latency of Kitex in connection pool mode is the lowest of all frameworks. In multiplexing mode, Kitex also performs well in each indicator.</p><p><strong>Configuration</strong></p><ul><li>Client 16 CPUs，Server 4 CPUs</li><li>1KB Request Package Size, Echo Scenario</li></ul><p><strong>Reference Data</strong></p><ul><li>KITEX: Connection Pool Model (Default Setting)</li><li>KITEX-MUX: Connection Multiplexing</li><li>Connection Multiplexing for all other Frameworks</li></ul><p><img src=/img/blog/kitex_performance_testing/qps.png alt=image>
<img src=/img/blog/kitex_performance_testing/tp99.png alt=image></p><h2 id=summary>Summary</h2><p>Each mainstream Golang open source RPC framework actually has its own focus in terms of design goals: some focus on generality,
some on scenarios with light business logic like Redis, some on throughput performance, and some on P99 latency.</p><p>In the daily iteration of ByteDance&rsquo;s business, it is common for a feature to cause one indicator to rise and another indicator to decline.
Therefore, Kitex was more inclined to solve various problems in large-scale microservice scenarios at the beginning of its design.</p><p>Since the launch of Kitex, we have received a large amount of self-testing data from our users. We appreciate the community for their attention and support.
We also encourage developers to use the testing guide provided in this article, and select appropriate tools for their own scenarios. For more questions, please make an Issue on GitHub.</p><h2 id=pertinent-links>Pertinent Links</h2><ul><li>CloudWeGo Official Website: <a href=https://www.cloudwego.io>https://www.cloudwego.io</a></li><li>Kitex: <a href=https://github.com/cloudwego/kitex>https://github.com/cloudwego/kitex</a></li><li>Netpoll: <a href=https://github.com/cloudwego/netpoll>https://github.com/cloudwego/netpoll</a></li><li>kitex-benchmark: <a href=https://github.com/cloudwego/kitex-benchmark>https://github.com/cloudwego/kitex-benchmark</a></li><li>netpoll-benchmark: <a href=https://github.com/cloudwego/netpoll-benchmark>https://github.com/cloudwego/netpoll-benchmark</a></li><li>Go Protobuf Library: <a href=https://github.com/golang/protobuf>https://github.com/golang/protobuf</a></li><li>Thriftgo：https://github.com/cloudwego/thriftgo</li></ul><ul class="list-unstyled d-flex justify-content-between align-items-center mb-0 pt-5"><li><a href=/blog/2021/10/09/bytedance-practices-on-go-network-library/ aria-label="Previous - ByteDance Practices on Go Network Library" class="btn btn-primary"><span class=mr-1>←</span> Previous</a></li><a href=/blog/2022/03/25/an-article-to-learn-about-bytedance-microservices-middleware-cloudwego/ aria-label="Next - An Article to Learn About ByteDance Microservices Middleware CloudWeGo" class="btn btn-primary">Next <span class=ml-1>→</span></a></li></ul></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2022 The CloudWeGo Authors</small><p class="mt-2 text-white"><a class=cloudwego-link href=/about/ target=_blank rel=noopener>About</a>
|
<a class=cloudwego-link href=https://github.com/cloudwego/cloudwego.github.io/blob/main/LICENSE target=_blank rel=noopener>License</a></p></div></div></div></footer></div><script src=https://cdn.staticfile.org/popper.js/1.16.1/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script><script src=https://cdn.staticfile.org/bootstrap/4.6.0/js/bootstrap.min.js integrity=sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF crossorigin=anonymous></script><script src=/js/main.min.5c74b870c6953931a705f390a49c7e4c0a842ec5c83b24354758dd674343ed0d.js integrity="sha256-XHS4cMaVOTGnBfOQpJx+TAqELsXIOyQ1R1jdZ0ND7Q0=" crossorigin=anonymous></script></body></html>