<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.85.0"><meta name=ROBOTS content="INDEX, FOLLOW"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>JWT | CloudWeGo</title><meta name=description content="A leading practice for building enterprise cloud native middleware!"><meta property="og:title" content="JWT"><meta property="og:description" content="JSON Web Token (JWT) is a lightweight authentication specification that allows us to use JWT to deliver secure and reliable information between users and servers. Essentially a token, it is a compact security method for passing between two sides of network communication. Hertz also provides an implementation of JWT, it uses gin implementation for reference.
As for usage, you may refer to hertz example
package main import ( &#34;context&#34; &#34;log&#34; &#34;time&#34; &#34;github."><meta property="og:type" content="article"><meta property="og:url" content="/docs/hertz/tutorials/basic-feature/middleware/jwt/"><meta property="article:section" content="docs"><meta property="article:published_time" content="2022-06-09T00:00:00+00:00"><meta property="article:modified_time" content="2022-06-16T18:11:04+08:00"><meta property="og:site_name" content="CloudWeGo"><meta itemprop=name content="JWT"><meta itemprop=description content="JSON Web Token (JWT) is a lightweight authentication specification that allows us to use JWT to deliver secure and reliable information between users and servers. Essentially a token, it is a compact security method for passing between two sides of network communication. Hertz also provides an implementation of JWT, it uses gin implementation for reference.
As for usage, you may refer to hertz example
package main import ( &#34;context&#34; &#34;log&#34; &#34;time&#34; &#34;github."><meta itemprop=datePublished content="2022-06-09T00:00:00+00:00"><meta itemprop=dateModified content="2022-06-16T18:11:04+08:00"><meta itemprop=wordCount content="486"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="JWT"><meta name=twitter:description content="JSON Web Token (JWT) is a lightweight authentication specification that allows us to use JWT to deliver secure and reliable information between users and servers. Essentially a token, it is a compact security method for passing between two sides of network communication. Hertz also provides an implementation of JWT, it uses gin implementation for reference.
As for usage, you may refer to hertz example
package main import ( &#34;context&#34; &#34;log&#34; &#34;time&#34; &#34;github."><script async src="https://www.googletagmanager.com/gtag/js?id=G-QYWRQRLPRM"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-QYWRQRLPRM')</script><link rel=preload href=/scss/main.min.f95524309453418871a413b9a587face83fc966617fd43915c481936076f7a1d.css as=style><link href=/scss/main.min.f95524309453418871a413b9a587face83fc966617fd43915c481936076f7a1d.css rel=stylesheet integrity><script src=https://cdn.staticfile.org/jquery/3.5.1/jquery.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','G-QYWRQRLPRM','auto'),ga('send','pageview'))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class=td-page><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/><span class=navbar-logo><img src=/img/logo.png></span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="dropdown sub-menu"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false><span>Documentation</span></a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/docs/kitex/>Kitex</a>
<a class=dropdown-item href=/docs/hertz/>Hertz</a>
<a class=dropdown-item href=/docs/netpoll/>Netpoll</a></div></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/about/><span>About</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/blog/><span>Blog</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/community/><span>Community</span></a></li><li class="nav-item dropdown mr-4 d-none d-lg-block"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>English</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/zh/docs/hertz/tutorials/basic-feature/middleware/jwt/>中文</a></div></li></ul></div><div class="navbar-nav d-none d-lg-block"></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><div id=content-mobile><form class="td-sidebar__search d-flex align-items-center"><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation"></button></form></div><div id=content-desktop></div><nav class="collapse td-sidebar-nav" id=td-section-nav><div class="nav-item dropdown d-block d-lg-none"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>English</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/zh/docs/hertz/tutorials/basic-feature/middleware/jwt/>中文</a></div></div><ul class="td-sidebar-nav__section pr-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docs-li><a href=/docs/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-docs><span>Documentation</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docshertz-li><a href=/docs/hertz/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docshertz><span>Hertz</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docshertzoverview-li><a href=/docs/hertz/overview/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docshertzoverview><span>Overview</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docshertzgetting-started-li><a href=/docs/hertz/getting-started/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docshertzgetting-started><span>Getting Started</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docshertztutorials-li><a href=/docs/hertz/tutorials/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docshertztutorials><span>Tutorials</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docshertztutorialsbasic-feature-li><a href=/docs/hertz/tutorials/basic-feature/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docshertztutorialsbasic-feature><span>Basic Feature</span></a><ul class="ul-4 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docshertztutorialsbasic-featuremiddleware-li><a href=/docs/hertz/tutorials/basic-feature/middleware/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docshertztutorialsbasic-featuremiddleware><span>Middleware Overview</span></a><ul class="ul-5 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docshertztutorialsbasic-featuremiddlewarecors-li><a href=/docs/hertz/tutorials/basic-feature/middleware/cors/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docshertztutorialsbasic-featuremiddlewarecors><span>CORS</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docshertztutorialsbasic-featuremiddlewarebasic-auth-li><a href=/docs/hertz/tutorials/basic-feature/middleware/basic-auth/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docshertztutorialsbasic-featuremiddlewarebasic-auth><span>Basic Auth</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-docshertztutorialsbasic-featuremiddlewarejwt-li><a href=/docs/hertz/tutorials/basic-feature/middleware/jwt/ class="align-left pl-0 active td-sidebar-link td-sidebar-link__page" id=m-docshertztutorialsbasic-featuremiddlewarejwt><span class=td-sidebar-nav-active-item>JWT</span></a></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/cloudwego/cloudwego.github.io/edit/main/content/en/docs/hertz/tutorials/basic-feature/middleware/jwt.md target=_blank><i class="fa fa-edit fa-fw"></i> Edit this page</a>
<a href="https://github.com/cloudwego/cloudwego.github.io/new/main/content/en/docs/hertz/tutorials/basic-feature/middleware/jwt.md?filename=change-me.md&value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" target=_blank><i class="fa fa-edit fa-fw"></i> Create child page</a>
<a href="https://github.com/cloudwego/cloudwego.github.io/issues/new?title=JWT" target=_blank><i class="fab fa-github fa-fw"></i> Create documentation issue</a>
<a href=https://github.com/cloudwego/kitex/issues/new target=_blank><i class="fas fa-tasks fa-fw"></i> Create project issue</a></div></aside><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><nav aria-label=breadcrumb class="d-none d-md-block d-print-none"><ol class="breadcrumb spb-1"><li class=breadcrumb-item><a href=/docs/>Documentation</a></li><li class=breadcrumb-item><a href=/docs/hertz/>Hertz</a></li><li class=breadcrumb-item><a href=/docs/hertz/tutorials/>Tutorials</a></li><li class=breadcrumb-item><a href=/docs/hertz/tutorials/basic-feature/>Basic Feature</a></li><li class=breadcrumb-item><a href=/docs/hertz/tutorials/basic-feature/middleware/>Middleware Overview</a></li><li class="breadcrumb-item active" aria-current=page><a href=/docs/hertz/tutorials/basic-feature/middleware/jwt/>JWT</a></li></ol></nav><div class=td-content><h1>JWT</h1><header class=article-meta></header><p>JSON Web Token (JWT) is a lightweight authentication specification that allows us to use JWT to deliver secure and reliable information between users and servers. Essentially a token, it is a compact security method for passing between two sides of network communication.
Hertz also provides an <a href=https://github.com/hertz-contrib/jwt>implementation</a> of JWT, it uses gin <a href=https://github.com/appleboy/gin-jwt>implementation</a> for reference.</p><p>As for usage, you may refer to hertz <a href=https://github.com/hertz-contrib/jwt/blob/main/example/basic/main.go>example</a></p><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>main</span>

<span style=color:#204a87;font-weight:700>import</span> <span style=color:#000;font-weight:700>(</span>
	<span style=color:#4e9a06>&#34;context&#34;</span>
	<span style=color:#4e9a06>&#34;log&#34;</span>
	<span style=color:#4e9a06>&#34;time&#34;</span>

	<span style=color:#4e9a06>&#34;github.com/cloudwego/hertz/pkg/app&#34;</span>
	<span style=color:#4e9a06>&#34;github.com/cloudwego/hertz/pkg/app/server&#34;</span>
	<span style=color:#4e9a06>&#34;github.com/hertz-contrib/jwt&#34;</span>
<span style=color:#000;font-weight:700>)</span>

<span style=color:#204a87;font-weight:700>type</span> <span style=color:#000>login</span> <span style=color:#204a87;font-weight:700>struct</span> <span style=color:#000;font-weight:700>{</span>
	<span style=color:#000>Username</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#4e9a06>`form:&#34;username,required&#34; json:&#34;username,required&#34;`</span> <span style=color:#8f5902;font-style:italic>//lint:ignore SA5008 ignoreCheck
</span><span style=color:#8f5902;font-style:italic></span>	<span style=color:#000>Password</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#4e9a06>`form:&#34;password,required&#34; json:&#34;password,required&#34;`</span> <span style=color:#8f5902;font-style:italic>//lint:ignore SA5008 ignoreCheck
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#000;font-weight:700>}</span>

<span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>identityKey</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;id&#34;</span>

<span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>PingHandler</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>c</span> <span style=color:#000>context</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Context</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>ctx</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>app</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>RequestContext</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
	<span style=color:#000>ctx</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>JSON</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>200</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>map</span><span style=color:#000;font-weight:700>[</span><span style=color:#204a87;font-weight:700>string</span><span style=color:#000;font-weight:700>]</span><span style=color:#204a87;font-weight:700>string</span><span style=color:#000;font-weight:700>{</span>
		<span style=color:#4e9a06>&#34;ping&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;pong&#34;</span><span style=color:#000;font-weight:700>,</span>
	<span style=color:#000;font-weight:700>})</span>
<span style=color:#000;font-weight:700>}</span>

<span style=color:#8f5902;font-style:italic>// User demo
</span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>type</span> <span style=color:#000>User</span> <span style=color:#204a87;font-weight:700>struct</span> <span style=color:#000;font-weight:700>{</span>
	<span style=color:#000>UserName</span>  <span style=color:#204a87;font-weight:700>string</span>
	<span style=color:#000>FirstName</span> <span style=color:#204a87;font-weight:700>string</span>
	<span style=color:#000>LastName</span>  <span style=color:#204a87;font-weight:700>string</span>
<span style=color:#000;font-weight:700>}</span>

<span style=color:#204a87;font-weight:700>func</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
	<span style=color:#000>h</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>server</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Default</span><span style=color:#000;font-weight:700>()</span>

	<span style=color:#8f5902;font-style:italic>// the jwt middleware
</span><span style=color:#8f5902;font-style:italic></span>	<span style=color:#000>authMiddleware</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>jwt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>New</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>jwt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>HertzJWTMiddleware</span><span style=color:#000;font-weight:700>{</span>
		<span style=color:#000>Realm</span><span style=color:#000;font-weight:700>:</span>       <span style=color:#4e9a06>&#34;test zone&#34;</span><span style=color:#000;font-weight:700>,</span>
		<span style=color:#000>Key</span><span style=color:#000;font-weight:700>:</span>         <span style=color:#000;font-weight:700>[]</span><span style=color:#204a87>byte</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;secret key&#34;</span><span style=color:#000;font-weight:700>),</span>
		<span style=color:#000>Timeout</span><span style=color:#000;font-weight:700>:</span>     <span style=color:#000>time</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Hour</span><span style=color:#000;font-weight:700>,</span>
		<span style=color:#000>MaxRefresh</span><span style=color:#000;font-weight:700>:</span>  <span style=color:#000>time</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Hour</span><span style=color:#000;font-weight:700>,</span>
		<span style=color:#000>IdentityKey</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>identityKey</span><span style=color:#000;font-weight:700>,</span>
		<span style=color:#000>PayloadFunc</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>data</span> <span style=color:#204a87;font-weight:700>interface</span><span style=color:#000;font-weight:700>{})</span> <span style=color:#000>jwt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>MapClaims</span> <span style=color:#000;font-weight:700>{</span>
			<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>v</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>ok</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>data</span><span style=color:#000;font-weight:700>.(</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>User</span><span style=color:#000;font-weight:700>);</span> <span style=color:#000>ok</span> <span style=color:#000;font-weight:700>{</span>
				<span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>jwt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>MapClaims</span><span style=color:#000;font-weight:700>{</span>
					<span style=color:#000>identityKey</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>v</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>UserName</span><span style=color:#000;font-weight:700>,</span>
				<span style=color:#000;font-weight:700>}</span>
			<span style=color:#000;font-weight:700>}</span>
			<span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>jwt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>MapClaims</span><span style=color:#000;font-weight:700>{}</span>
		<span style=color:#000;font-weight:700>},</span>
		<span style=color:#000>IdentityHandler</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ctx</span> <span style=color:#000>context</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Context</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>c</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>app</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>RequestContext</span><span style=color:#000;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>interface</span><span style=color:#000;font-weight:700>{}</span> <span style=color:#000;font-weight:700>{</span>
			<span style=color:#000>claims</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>jwt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ExtractClaims</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ctx</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>c</span><span style=color:#000;font-weight:700>)</span>
			<span style=color:#204a87;font-weight:700>return</span> <span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>User</span><span style=color:#000;font-weight:700>{</span>
				<span style=color:#000>UserName</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>claims</span><span style=color:#000;font-weight:700>[</span><span style=color:#000>identityKey</span><span style=color:#000;font-weight:700>].(</span><span style=color:#204a87;font-weight:700>string</span><span style=color:#000;font-weight:700>),</span>
			<span style=color:#000;font-weight:700>}</span>
		<span style=color:#000;font-weight:700>},</span>
		<span style=color:#000>Authenticator</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ctx</span> <span style=color:#000>context</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Context</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>c</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>app</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>RequestContext</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>interface</span><span style=color:#000;font-weight:700>{},</span> <span style=color:#204a87;font-weight:700>error</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
			<span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>loginVals</span> <span style=color:#000>login</span>
			<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>c</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>BindAndValidate</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>loginVals</span><span style=color:#000;font-weight:700>);</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
				<span style=color:#204a87;font-weight:700>return</span> <span style=color:#4e9a06>&#34;&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>jwt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ErrMissingLoginValues</span>
			<span style=color:#000;font-weight:700>}</span>
			<span style=color:#000>userID</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>loginVals</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Username</span>
			<span style=color:#000>password</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>loginVals</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Password</span>

			<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>userID</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;admin&#34;</span> <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> <span style=color:#000>password</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;admin&#34;</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>||</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>userID</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;test&#34;</span> <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> <span style=color:#000>password</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;test&#34;</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
				<span style=color:#204a87;font-weight:700>return</span> <span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>User</span><span style=color:#000;font-weight:700>{</span>
					<span style=color:#000>UserName</span><span style=color:#000;font-weight:700>:</span>  <span style=color:#000>userID</span><span style=color:#000;font-weight:700>,</span>
					<span style=color:#000>LastName</span><span style=color:#000;font-weight:700>:</span>  <span style=color:#4e9a06>&#34;Hertz&#34;</span><span style=color:#000;font-weight:700>,</span>
					<span style=color:#000>FirstName</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;CloudWeGo&#34;</span><span style=color:#000;font-weight:700>,</span>
				<span style=color:#000;font-weight:700>},</span> <span style=color:#204a87;font-weight:700>nil</span>
			<span style=color:#000;font-weight:700>}</span>

			<span style=color:#204a87;font-weight:700>return</span> <span style=color:#204a87;font-weight:700>nil</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>jwt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ErrFailedAuthentication</span>
		<span style=color:#000;font-weight:700>},</span>
		<span style=color:#000>Authorizator</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>data</span> <span style=color:#204a87;font-weight:700>interface</span><span style=color:#000;font-weight:700>{},</span> <span style=color:#000>ctx</span> <span style=color:#000>context</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Context</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>c</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>app</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>RequestContext</span><span style=color:#000;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>bool</span> <span style=color:#000;font-weight:700>{</span>
			<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>v</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>ok</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>data</span><span style=color:#000;font-weight:700>.(</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>User</span><span style=color:#000;font-weight:700>);</span> <span style=color:#000>ok</span> <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> <span style=color:#000>v</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>UserName</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;admin&#34;</span> <span style=color:#000;font-weight:700>{</span>
				<span style=color:#204a87;font-weight:700>return</span> <span style=color:#204a87;font-weight:700>true</span>
			<span style=color:#000;font-weight:700>}</span>

			<span style=color:#204a87;font-weight:700>return</span> <span style=color:#204a87;font-weight:700>false</span>
		<span style=color:#000;font-weight:700>},</span>
		<span style=color:#000>Unauthorized</span><span style=color:#000;font-weight:700>:</span> <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ctx</span> <span style=color:#000>context</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Context</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>c</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>app</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>RequestContext</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>code</span> <span style=color:#204a87;font-weight:700>int</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>message</span> <span style=color:#204a87;font-weight:700>string</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
			<span style=color:#000>c</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>JSON</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>code</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>map</span><span style=color:#000;font-weight:700>[</span><span style=color:#204a87;font-weight:700>string</span><span style=color:#000;font-weight:700>]</span><span style=color:#204a87;font-weight:700>interface</span><span style=color:#000;font-weight:700>{}{</span>
				<span style=color:#4e9a06>&#34;code&#34;</span><span style=color:#000;font-weight:700>:</span>    <span style=color:#000>code</span><span style=color:#000;font-weight:700>,</span>
				<span style=color:#4e9a06>&#34;message&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>message</span><span style=color:#000;font-weight:700>,</span>
			<span style=color:#000;font-weight:700>})</span>
		<span style=color:#000;font-weight:700>},</span>
		<span style=color:#8f5902;font-style:italic>// TokenLookup is a string in the form of &#34;&lt;source&gt;:&lt;name&gt;&#34; that is used
</span><span style=color:#8f5902;font-style:italic></span>		<span style=color:#8f5902;font-style:italic>// to extract token from the request.
</span><span style=color:#8f5902;font-style:italic></span>		<span style=color:#8f5902;font-style:italic>// Optional. Default value &#34;header:Authorization&#34;.
</span><span style=color:#8f5902;font-style:italic></span>		<span style=color:#8f5902;font-style:italic>// Possible values:
</span><span style=color:#8f5902;font-style:italic></span>		<span style=color:#8f5902;font-style:italic>// - &#34;header:&lt;name&gt;&#34;
</span><span style=color:#8f5902;font-style:italic></span>		<span style=color:#8f5902;font-style:italic>// - &#34;query:&lt;name&gt;&#34;
</span><span style=color:#8f5902;font-style:italic></span>		<span style=color:#8f5902;font-style:italic>// - &#34;cookie:&lt;name&gt;&#34;
</span><span style=color:#8f5902;font-style:italic></span>		<span style=color:#8f5902;font-style:italic>// - &#34;param:&lt;name&gt;&#34;
</span><span style=color:#8f5902;font-style:italic></span>		<span style=color:#000>TokenLookup</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;header: Authorization, query: token, cookie: jwt&#34;</span><span style=color:#000;font-weight:700>,</span>
		<span style=color:#8f5902;font-style:italic>// TokenLookup: &#34;query:token&#34;,
</span><span style=color:#8f5902;font-style:italic></span>		<span style=color:#8f5902;font-style:italic>// TokenLookup: &#34;cookie:token&#34;,
</span><span style=color:#8f5902;font-style:italic></span>
		<span style=color:#8f5902;font-style:italic>// TokenHeadName is a string in the header. Default value is &#34;Bearer&#34;
</span><span style=color:#8f5902;font-style:italic></span>		<span style=color:#000>TokenHeadName</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;Bearer&#34;</span><span style=color:#000;font-weight:700>,</span>

		<span style=color:#8f5902;font-style:italic>// TimeFunc provides the current time. You can override it to use another time value. This is useful for testing or if your server uses a different time zone than your tokens.
</span><span style=color:#8f5902;font-style:italic></span>		<span style=color:#000>TimeFunc</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>time</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Now</span><span style=color:#000;font-weight:700>,</span>
	<span style=color:#000;font-weight:700>})</span>
	<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
		<span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Fatal</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;JWT Error:&#34;</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>err</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Error</span><span style=color:#000;font-weight:700>())</span>
	<span style=color:#000;font-weight:700>}</span>

	<span style=color:#8f5902;font-style:italic>// When you use jwt.New(), the function is already automatically called for checking,
</span><span style=color:#8f5902;font-style:italic></span>	<span style=color:#8f5902;font-style:italic>// which means you don&#39;t need to call it again.
</span><span style=color:#8f5902;font-style:italic></span>	<span style=color:#000>errInit</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>authMiddleware</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>MiddlewareInit</span><span style=color:#000;font-weight:700>()</span>

	<span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>errInit</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
		<span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Fatal</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;authMiddleware.MiddlewareInit() Error:&#34;</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>errInit</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Error</span><span style=color:#000;font-weight:700>())</span>
	<span style=color:#000;font-weight:700>}</span>

	<span style=color:#000>h</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>POST</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;/login&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>authMiddleware</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>LoginHandler</span><span style=color:#000;font-weight:700>)</span>

	<span style=color:#000>h</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>NoRoute</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>authMiddleware</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>MiddlewareFunc</span><span style=color:#000;font-weight:700>(),</span> <span style=color:#204a87;font-weight:700>func</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ctx</span> <span style=color:#000>context</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Context</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>c</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>app</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>RequestContext</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
		<span style=color:#000>claims</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>jwt</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ExtractClaims</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>ctx</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>c</span><span style=color:#000;font-weight:700>)</span>
		<span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Printf</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;NoRoute claims: %#v\n&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>claims</span><span style=color:#000;font-weight:700>)</span>
		<span style=color:#000>c</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>JSON</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>404</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>map</span><span style=color:#000;font-weight:700>[</span><span style=color:#204a87;font-weight:700>string</span><span style=color:#000;font-weight:700>]</span><span style=color:#204a87;font-weight:700>string</span><span style=color:#000;font-weight:700>{</span><span style=color:#4e9a06>&#34;code&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;PAGE_NOT_FOUND&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;message&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;Page not found&#34;</span><span style=color:#000;font-weight:700>})</span>
	<span style=color:#000;font-weight:700>})</span>

	<span style=color:#000>auth</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>h</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Group</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;/auth&#34;</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#8f5902;font-style:italic>// Refresh time can be longer than token timeout
</span><span style=color:#8f5902;font-style:italic></span>	<span style=color:#000>auth</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GET</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;/refresh_token&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>authMiddleware</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>RefreshHandler</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#000>auth</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Use</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>authMiddleware</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>MiddlewareFunc</span><span style=color:#000;font-weight:700>())</span>
	<span style=color:#000;font-weight:700>{</span>
		<span style=color:#000>auth</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GET</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;/ping&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>PingHandler</span><span style=color:#000;font-weight:700>)</span>
	<span style=color:#000;font-weight:700>}</span>

	<span style=color:#000>h</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Spin</span><span style=color:#000;font-weight:700>()</span>
<span style=color:#000;font-weight:700>}</span>
</code></pre></div><style>.feedback--answer{display:inline-block}.feedback--answer-no{margin-left:1em}.feedback--response{display:none;margin-top:1em}.feedback--response__visible{display:block}</style><div class=d-print-none><h2 class=feedback--title>Feedback</h2><p class=feedback--question>Was this page helpful?</p><button class="btn btn-primary mb-4 feedback--answer feedback--answer-yes">Yes</button>
<button class="btn btn-primary mb-4 feedback--answer feedback--answer-no">No</button><p class="feedback--response feedback--response-yes"><a href=https://github.com/cloudwego/cloudwego.github.io/issues/new>Please tell us how we can improve</a>.</p><p class="feedback--response feedback--response-no"><a href=https://github.com/cloudwego/cloudwego.github.io/issues/new>Please tell us how we can improve</a>.</p></div><script>const yesButton=document.querySelector('.feedback--answer-yes'),noButton=document.querySelector('.feedback--answer-no'),yesResponse=document.querySelector('.feedback--response-yes'),noResponse=document.querySelector('.feedback--response-no'),disableButtons=()=>{yesButton.disabled=!0,noButton.disabled=!0},sendFeedback=b=>{if(typeof ga!='function')return;const a={command:'send',hitType:'event',category:'Helpful',action:'click',label:window.location.pathname,value:b};ga(a.command,a.hitType,a.category,a.action,a.label,a.value)};yesButton.addEventListener('click',()=>{yesResponse.classList.add('feedback--response__visible'),disableButtons(),sendFeedback(1)}),noButton.addEventListener('click',()=>{noResponse.classList.add('feedback--response__visible'),disableButtons(),sendFeedback(0)})</script><br><div class="text-muted mt-5 pt-3 border-top">Last modified
June 16, 2022
: <a href=https://github.com/cloudwego/cloudwego.github.io/commit/81bb96c85f835e68bcd93e7ffbb7e42207c17418>docs(FAQ): add English translation for new questions (#199) (81bb96c)</a></div></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2022 The CloudWeGo Authors</small><p class="mt-2 text-white"><a class=cloudwego-link href=/about/ target=_blank rel=noopener>About</a>
|
<a class=cloudwego-link href=https://github.com/cloudwego/cloudwego.github.io/blob/main/LICENSE target=_blank rel=noopener>License</a></p></div></div></div></footer></div><script src=https://cdn.staticfile.org/popper.js/1.16.1/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script><script src=https://cdn.staticfile.org/bootstrap/4.6.0/js/bootstrap.min.js integrity=sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF crossorigin=anonymous></script><script src=/js/main.min.5c74b870c6953931a705f390a49c7e4c0a842ec5c83b24354758dd674343ed0d.js integrity="sha256-XHS4cMaVOTGnBfOQpJx+TAqELsXIOyQ1R1jdZ0ND7Q0=" crossorigin=anonymous></script></body></html>